# How to manage GovUK Notify email templates

## Context 
GovUK Notify emails can only be managed via the GOV.UK Notify platform, there is no programmatic API access available. This can make management and customisation tricky at times. In order to maintain consistency and make management simpler, we mirror the directory structure of GOV.UK Notify in our codebase.

Templates are located in `apps/api.planx.uk/lib/notify/templates`. Each template has "personalisations" (variables) that can be embedded in the template content ([docs](https://www.notifications.service.gov.uk/using-notify/personalisation)).

## Process

### Adding a new template

1. **Create in GOV.UK Notify**
   - Add the template in the GOV.UK Notify platform
   - Note the template ID and personalisation fields

2. **Add to repository**
   - Create a corresponding file in `apps/api.planx.uk/lib/notify/templates` following the existing directory structure
   - Map all personalisation fields required by the template

```ts
import { type NotifyConfig, type NotifyTemplate } from "../index.js";

/**
 * GovNotify template: <LINK TO GOVUK NOTIFY TEMPLATE HERE>
 */
export const myNewTemplate: NotifyTemplate<Config> = {
  id: {{ UUID generated by GovNotify }}
  access: "private",
  config: {} as Config,
};

export type Config = NotifyConfig<{
  personalisation1: string;
  personalisation2: string;
  personalisation3: string;
}>;
```

3. **Update template registry**
   - Add the new template to the template registry in `apps/api.planx.uk/lib/notify/templates/index.ts`

```ts
export const templateRegistry = {
  "my-template-name": myNewTemplate
  ...
} as const;
```

4. **Implementation**
   - Ensure all the necessary fields are populated when the template is used
   - Verify that personalisation fields match between your code and the Notify platform - there is not type checking done by the Notify client at runtime.

### Updating an existing template

1. **Update codebase**
   - If adding or removing fields, update the code first since templates are live - changes will go into effect immediately
   - Additional fields are ignored, so these can be added in advance without any adverse effect

2. **Update GOV.UK Notify template**
   - After code changes are deployed to production, update the template in the GOV.UK Notify platform

> [!TIP]
> If making substantial changes to a template, it may be preferable to create a new template so that the changes are synced correctly on deploy