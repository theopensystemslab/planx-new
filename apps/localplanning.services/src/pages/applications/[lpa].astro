---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import { ApplicationViewer } from "@components/applications/ApplicationViewer";
import { fetchAllLPAs } from "@lib/lpa-api";
import type { GetStaticPaths, InferGetStaticPropsType } from "astro";
import LpaMasthead from "@components/LpaMasthead.astro";

export const getStaticPaths = (async () => {
  const lpas = await fetchAllLPAs();
  return lpas.map((lpa) => ({
    params: { lpa: lpa.slug },
    props: { lpaData: lpa },
  }));
}) satisfies GetStaticPaths;

const { lpaData } = Astro.props;
const title = "Your application";

// TODO: Pass title as prop into layout?
// type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

if (!lpaData) return Astro.redirect("/404");
---

<Layout title={title}>
  <LpaMasthead
    title={title}
    lpaName={lpaData.name}
    logo={lpaData.theme.logo}
    backgroundColour={lpaData.theme?.primaryColour}
  />
  <Container paddingY>
    <ApplicationViewer client:only="react" />
  </Container>
</Layout>
