name: "Automatic production deployment"

on:
  # TODO: Enable CRON after the holiday season
  # schedule:
  #   # “At 09:00 on every day-of-week from Tuesday through Friday.” 
  #   -   cron: "0 9 * * 2-5"
  workflow_dispatch:

jobs:
  backup:
    runs-on: ubuntu-latest
    name: Force-push to the production branch
    steps:
    - name: sync
      env:
        # Uses `github.token`: the default, ephemeral token automatically generated by GitHub
        # https://docs.github.com/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token
        PERSONAL_ACCESS_TOKEN: ${{ github.token }}
      run: |
        set -xe
        git clone "https://theopensystemslab:${PERSONAL_ACCESS_TOKEN}@github.com/theopensystemslab/planx-new.git" planx-new
        cd planx-new || exit 1
        git push --force origin origin/main:production
