const __vite__fileDeps=["assets/feedback-NqJ1fYKx.js","assets/index-CFPw1vJP.js","assets/index-CpQhEK74.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as T,bj as ar,bk as rr,bl as ir,bm as ct,bn as or,j as t,B as b,T as I,z as Et,y as Lt,s as $,aS as B,b as L,bo as ut,a0 as lr,be as sr,A as Ie,_ as _e,C as ve,E as $e,u as N,bh as me,p as u,n as fe,q as g,t as R,v as X,w as Q,a3 as Nt,R as on,bp as dr,I as Ke,bq as cr,Q as He,a1 as Vt,br as ht,bs as We,bt as Ve,bu as ur,bv as se,bw as Sn,ai as un,bx as Qe,a2 as de,a6 as c,by as hr,bz as Tn,bA as Je,bB as qe,bC as Ge,bD as pr,bE as zt,bF as fn,bG as fr,bH as vr,b8 as Ee,bI as mr,bJ as k,bK as _,bL as O,bM as H,bN as V,ay as gr,as as Mn,bO as hn,bP as En,bQ as xr,b6 as rn,bf as Xe,m as yr,b9 as le,bR as br,bS as jr,bi as Ln,G as Ue,am as Bt,J as Me,K as Nn,H as Ut,U as ln,W as qt,M as Ce,S as we,aa as Ht,a8 as Cr,aX as wr,V as Vn,N as Wt,bT as Sr,X as pt,Y as ze}from"./index-CFPw1vJP.js";import{E as ce}from"./EditorRow-Cyc30Qxl.js";import{F as Gt,I as Tr,S as Ir,A as _r,T as $r,t as Pr,b as Rr,C as Yt,a as kr}from"./index-DE9PmoNh.js";import{u as D,I as Ne,f as Fr,s as Jt,v as zn,w as Or,D as Kt,o as Xt,p as Qt,q as Zt,C as Dr,L as Ar,x as ge,y as Mr,z as Er,B as Lr,E as ea,F as ft,O as Nr,G as Vr,J as zr,K as Br,M as Ur,k as na,N as vt,j as qr}from"./Header-p4OIyhRV.js";import{u as Hr,n as Wr,E as Bn,o as Gr,p as In,Q as Yr,L as Jr,q as Kr,r as Xr,s as mt,v as Qr,w as Zr,x as ei,y as ta,z as ni,A as ti,D as ai,G as gt,H as xt,J as ri,h as ii,K as oi,M as li,N as si,O as yt,P as di,T as ci,U as ui,c as hi,V as pi,W as Ae,X as fi,g as vi,Y as mi}from"./Questions-D-dg2tg0.js";import{T as gi,a as xi,b as yi,c as _n,d as ie,e as bi}from"./TableRow-twy3mylU.js";import{C as bt}from"./Chip-BB62kn49.js";import{A as ji}from"./index-CO01K9Q0.js";import{f as aa,S as Ci}from"./team-DwYuIZil.js";import{D as sn}from"./Divider-B5Mpa2_2.js";import{L as Te}from"./authenticated-Ct7udYJY.js";import{I as wi}from"./InputRowLabel-DT0xESl6.js";import"./Card-XAp8rL3L.js";function ra(e,n){var a=T.useRef(!1),r=ar(n==null?void 0:n.client);rr(e,ir.Subscription);var i=T.useState({loading:!(n!=null&&n.skip),error:void 0,data:void 0,variables:n==null?void 0:n.variables}),o=i[0],l=i[1];a.current||(a.current=!0,n!=null&&n.onSubscriptionData&&globalThis.__DEV__!==!1&&ct.warn(n.onData?52:53),n!=null&&n.onSubscriptionComplete&&globalThis.__DEV__!==!1&&ct.warn(n.onComplete?54:55));var s=T.useState(function(){return n!=null&&n.skip?null:r.subscribe({query:e,variables:n==null?void 0:n.variables,fetchPolicy:n==null?void 0:n.fetchPolicy,context:n==null?void 0:n.context})}),d=s[0],p=s[1],v=T.useRef(!1);T.useEffect(function(){return function(){v.current=!0}},[]);var f=T.useRef({client:r,subscription:e,options:n});return T.useEffect(function(){var x,C,m,h,y=n==null?void 0:n.shouldResubscribe;typeof y=="function"&&(y=!!y(n)),n!=null&&n.skip?(!(n!=null&&n.skip)!=!(!((x=f.current.options)===null||x===void 0)&&x.skip)||v.current)&&(l({loading:!1,data:void 0,error:void 0,variables:n==null?void 0:n.variables}),p(null),v.current=!1):(y!==!1&&(r!==f.current.client||e!==f.current.subscription||(n==null?void 0:n.fetchPolicy)!==((C=f.current.options)===null||C===void 0?void 0:C.fetchPolicy)||!(n!=null&&n.skip)!=!(!((m=f.current.options)===null||m===void 0)&&m.skip)||!or(n==null?void 0:n.variables,(h=f.current.options)===null||h===void 0?void 0:h.variables))||v.current)&&(l({loading:!0,data:void 0,error:void 0,variables:n==null?void 0:n.variables}),p(r.subscribe({query:e,variables:n==null?void 0:n.variables,fetchPolicy:n==null?void 0:n.fetchPolicy,context:n==null?void 0:n.context})),v.current=!1),Object.assign(f.current,{client:r,subscription:e,options:n})},[r,e,n,v.current]),T.useEffect(function(){if(d){var x=!1,C=d.subscribe({next:function(m){var h,y;if(!x){var w={loading:!1,data:m.data,error:void 0,variables:n==null?void 0:n.variables};l(w),!((h=f.current.options)===null||h===void 0)&&h.onData?f.current.options.onData({client:r,data:w}):!((y=f.current.options)===null||y===void 0)&&y.onSubscriptionData&&f.current.options.onSubscriptionData({client:r,subscriptionData:w})}},error:function(m){var h,y;x||(l({loading:!1,data:void 0,error:m,variables:n==null?void 0:n.variables}),(y=(h=f.current.options)===null||h===void 0?void 0:h.onError)===null||y===void 0||y.call(h,m))},complete:function(){var m,h;x||(!((m=f.current.options)===null||m===void 0)&&m.onComplete?f.current.options.onComplete():!((h=f.current.options)===null||h===void 0)&&h.onSubscriptionComplete&&f.current.options.onSubscriptionComplete())}});return function(){x=!0,setTimeout(function(){C.unsubscribe()})}}},[d]),o}const Si=e=>{const n=T.useRef({});return T.useEffect(()=>{n.current=e}),n.current};function Ti(e){const{badgeContent:n,invisible:a=!1,max:r=99,showZero:i=!1}=e,o=Hr({badgeContent:n,max:r});let l=a;a===!1&&n===0&&!i&&(l=!0);const{badgeContent:s,max:d=r}=l?o:e,p=s&&Number(s)>d?`${d}+`:s;return{badgeContent:s,invisible:l,max:d,displayValue:p}}var ia={};Object.defineProperty(ia,"__esModule",{value:!0});function Ii(e){e===void 0&&(e={});var n=/^0/,a=/\s+/g,r=/^\s+|\s+$/g,i=/[^\x00-\x80]/,o=/^0x[0-9a-f]+$/i,l=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=String.prototype.toLocaleLowerCase||String.prototype.toLowerCase,p=e.desc?-1:1,v=-p,f=e.insensitive?function(m){return d.call(""+m).replace(r,"")}:function(m){return(""+m).replace(r,"")};function x(m){return m.replace(l,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function C(m,h){return(!m.match(n)||h===1)&&parseFloat(m)||m.replace(a," ").replace(r,"")||0}return function(m,h){var y=f(m),w=f(h);if(!y&&!w)return 0;if(!y&&w)return v;if(y&&!w)return p;var j=x(y),E=x(w),W=y.match(o),U=w.match(o),q=W&&U?parseInt(W[0],16):j.length!==1&&Date.parse(y),J=W&&U?parseInt(U[0],16):q&&w.match(s)&&Date.parse(w)||null;if(J){if(q===J)return 0;if(q<J)return v;if(q>J)return p}for(var G=j.length,Z=E.length,Y=0,ee=Math.max(G,Z);Y<ee;Y+=1){var S=C(j[Y]||"",G),A=C(E[Y]||"",Z);if(isNaN(S)!==isNaN(A))return isNaN(S)?p:v;if(i.test(S+A)&&S.localeCompare){var F=S.localeCompare(A);if(F>0)return p;if(F<0)return v;if(Y===ee-1)return 0}if(S<A)return v;if(S>A)return p;if(""+S<""+A)return v;if(""+S>""+A)return p}return 0}}var _i=ia.default=Ii;const oa=()=>t.jsxs(b,{maxWidth:"formWrap",mx:"auto",children:[t.jsxs(ce,{children:[t.jsx(I,{variant:"h2",component:"h3",gutterBottom:!0,children:"Data Manager"}),t.jsx(I,{variant:"body1",children:"Manage the data that your service uses and makes available via its API."})]}),t.jsx(ce,{children:t.jsx(Gt,{title:"Feature in development"})})]}),la=()=>t.jsxs(b,{maxWidth:"formWrap",mx:"auto",children:[t.jsxs(ce,{children:[t.jsx(I,{variant:"h2",component:"h3",gutterBottom:!0,children:"Service flags"}),t.jsx(I,{variant:"body1",children:"Manage the flag sets that this service uses. Flags at the top of a set override flags below."})]}),t.jsx(ce,{children:t.jsx(Gt,{title:"Feature in development"})})]});function $i(e){return Lt("MuiSwitch",e)}const K=Et("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Pi=["className","color","edge","size","sx"],Ri=e=>{const{classes:n,edge:a,size:r,color:i,checked:o,disabled:l}=e,s={root:["root",a&&`edge${B(a)}`,`size${B(r)}`],switchBase:["switchBase",`color${B(i)}`,o&&"checked",l&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=$e(s,$i,n);return L({},n,d)},ki=$("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:a}=e;return[n.root,a.edge&&n[`edge${B(a.edge)}`],n[`size${B(a.size)}`]]}})(({ownerState:e})=>L({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${K.thumb}`]:{width:16,height:16},[`& .${K.switchBase}`]:{padding:4,[`&.${K.checked}`]:{transform:"translateX(16px)"}}})),Fi=$(Wr,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,n)=>{const{ownerState:a}=e;return[n.switchBase,{[`& .${K.input}`]:n.input},a.color!=="default"&&n[`color${B(a.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${K.checked}`]:{transform:"translateX(20px)"},[`&.${K.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${K.checked} + .${K.track}`]:{opacity:.5},[`&.${K.disabled} + .${K.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${K.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:n})=>L({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:ut(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},n.color!=="default"&&{[`&.${K.checked}`]:{color:(e.vars||e).palette[n.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[n.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:ut(e.palette[n.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${K.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${n.color}DisabledColor`]:`${e.palette.mode==="light"?lr(e.palette[n.color].main,.62):sr(e.palette[n.color].main,.55)}`}},[`&.${K.checked} + .${K.track}`]:{backgroundColor:(e.vars||e).palette[n.color].main}})),Oi=$("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,n)=>n.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Di=$("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,n)=>n.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),Ai=T.forwardRef(function(n,a){const r=Ie({props:n,name:"MuiSwitch"}),{className:i,color:o="primary",edge:l=!1,size:s="medium",sx:d}=r,p=_e(r,Pi),v=L({},r,{color:o,edge:l,size:s}),f=Ri(v),x=t.jsx(Di,{className:f.thumb,ownerState:v});return t.jsxs(ki,{className:ve(f.root,i),sx:d,ownerState:v,children:[t.jsx(Fi,L({type:"checkbox",icon:x,checkedIcon:x,ref:a,ownerState:v},p,{classes:L({},f,{root:f.switchBase})})),t.jsx(Oi,{className:f.track,ownerState:v})]})}),vn=({title:e,richText:n=!1,description:a,switchProps:r,headingInputProps:i,contentInputProps:o})=>t.jsxs(b,{width:"100%",children:[t.jsxs(b,{mb:2,display:"flex",alignItems:"center",children:[t.jsx(Ai,{...r,color:"primary"}),t.jsx(I,{variant:"h4",component:"h5",children:e})]}),t.jsx(b,{mb:2,children:a&&t.jsx(I,{variant:"body2",children:a})}),t.jsx(u,{children:t.jsx(Ne,{children:t.jsx(g,{placeholder:"Heading",format:"bold",...i})})}),t.jsx(u,{children:t.jsx(Ne,{children:n?t.jsx(R,{placeholder:"Text",multiline:!0,rows:6,...o}):t.jsx(g,{placeholder:"Text",multiline:!0,rows:6,...o})})})]}),sa=()=>{var o,l,s,d,p,v,f,x,C,m,h,y,w,j,E,W,U,q,J,G,Z,Y,ee,S,A,F,xe,Pe,Re,ke,P,z,oe,ye,Fe,Oe;const e=N(ne=>ne.flowSettings),[n,a]=T.useState(!1),r=(ne,De)=>{De!=="clickaway"&&a(!1)},i=D({initialValues:{elements:{legalDisclaimer:{heading:((l=(o=e==null?void 0:e.elements)==null?void 0:o.legalDisclaimer)==null?void 0:l.heading)??"",content:((d=(s=e==null?void 0:e.elements)==null?void 0:s.legalDisclaimer)==null?void 0:d.content)??"",show:((v=(p=e==null?void 0:e.elements)==null?void 0:p.legalDisclaimer)==null?void 0:v.show)??!1},help:{heading:((x=(f=e==null?void 0:e.elements)==null?void 0:f.help)==null?void 0:x.heading)??"",content:((m=(C=e==null?void 0:e.elements)==null?void 0:C.help)==null?void 0:m.content)??"",show:((y=(h=e==null?void 0:e.elements)==null?void 0:h.help)==null?void 0:y.show)??!1},privacy:{heading:((j=(w=e==null?void 0:e.elements)==null?void 0:w.privacy)==null?void 0:j.heading)??"",content:((W=(E=e==null?void 0:e.elements)==null?void 0:E.privacy)==null?void 0:W.content)??"",show:((q=(U=e==null?void 0:e.elements)==null?void 0:U.privacy)==null?void 0:q.show)??!1}}},onSubmit:async ne=>{await N.getState().updateFlowSettings(ne),a(!0)},validate:()=>{}});return t.jsx(b,{maxWidth:"formWrap",mx:"auto",children:t.jsxs("form",{onSubmit:i.handleSubmit,children:[t.jsxs(ce,{children:[t.jsx(I,{variant:"h2",component:"h3",gutterBottom:!0,children:"Elements"}),t.jsx(I,{variant:"body1",children:"Manage the features that users will be able to see."})]}),t.jsx(ce,{background:!0,children:t.jsx(vn,{title:"Legal Disclaimer",description:"Displayed before a user submits their application",switchProps:{name:"elements.legalDisclaimer.show",checked:(G=(J=i.values.elements)==null?void 0:J.legalDisclaimer)==null?void 0:G.show,onChange:i.handleChange},headingInputProps:{name:"elements.legalDisclaimer.heading",value:(Y=(Z=i.values.elements)==null?void 0:Z.legalDisclaimer)==null?void 0:Y.heading,onChange:i.handleChange},contentInputProps:{name:"elements.legalDisclaimer.content",value:(S=(ee=i.values.elements)==null?void 0:ee.legalDisclaimer)==null?void 0:S.content,onChange:i.handleChange}})}),t.jsx(ce,{background:!0,children:t.jsxs(me,{flowSpacing:!0,children:[t.jsx(Tr,{children:"Footer Links"}),t.jsx(u,{children:t.jsx(vn,{title:"Help Page",richText:!0,description:"A place to communicate FAQs, useful tips, or contact information",switchProps:{name:"elements.help.show",checked:(F=(A=i.values.elements)==null?void 0:A.help)==null?void 0:F.show,onChange:i.handleChange},headingInputProps:{name:"elements.help.heading",value:(Pe=(xe=i.values.elements)==null?void 0:xe.help)==null?void 0:Pe.heading,onChange:i.handleChange},contentInputProps:{name:"elements.help.content",value:(ke=(Re=i.values.elements)==null?void 0:Re.help)==null?void 0:ke.content,onChange:i.handleChange}})}),t.jsx(u,{children:t.jsx(vn,{title:"Privacy Page",richText:!0,description:"Your privacy policy",switchProps:{name:"elements.privacy.show",checked:(z=(P=i.values.elements)==null?void 0:P.privacy)==null?void 0:z.show,onChange:i.handleChange},headingInputProps:{name:"elements.privacy.heading",value:(ye=(oe=i.values.elements)==null?void 0:oe.privacy)==null?void 0:ye.heading,onChange:i.handleChange},contentInputProps:{name:"elements.privacy.content",value:(Oe=(Fe=i.values.elements)==null?void 0:Fe.privacy)==null?void 0:Oe.content,onChange:i.handleChange}})})]})}),t.jsx(ce,{children:t.jsx(fe,{type:"submit",variant:"contained",color:"primary",disabled:!i.dirty,children:"Update elements"})}),t.jsx(Ir,{open:n,autoHideDuration:6e3,onClose:r,children:t.jsx(_r,{onClose:r,severity:"success",sx:{width:"100%"},children:"Service settings updated successfully"})})]})})};var Un={},Mi=Q;Object.defineProperty(Un,"__esModule",{value:!0});var da=Un.default=void 0,Ei=Mi(X()),Li=t,Ni=(0,Ei.default)((0,Li.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp");da=Un.default=Ni;var qn={},Vi=Q;Object.defineProperty(qn,"__esModule",{value:!0});var ca=qn.default=void 0,zi=Vi(X()),Bi=t,Ui=(0,zi.default)((0,Bi.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"}),"Payment");ca=qn.default=Ui;const qi=$(b)(({theme:e})=>({marginTop:e.spacing(1),padding:e.spacing(3),border:`5px solid ${e.palette.error.main}`})),jt=$(b)(()=>({fontSize:"1em",margin:1,maxWidth:"contentWrap",overflowWrap:"break-word",whiteSpace:"pre-wrap"})),Hi=$(gi)(()=>({maxHeight:"60vh",overflow:"auto",display:"flex",flexDirection:"column-reverse",readingOrder:"flex-visual"})),Wi=({submissions:e,loading:n,error:a})=>n?t.jsx(Nt,{msDelayBeforeVisible:0,text:"Fetching events..."}):a?t.jsx(Bn,{error:a}):e.length===0?t.jsxs(qi,{role:"status","data-testid":"error-summary",children:[t.jsx(I,{variant:"h4",gutterBottom:!0,children:"No payments or submissions found for this service"}),t.jsx(I,{variant:"body2",children:"If you're looking for events before January 1, 2024, please contact a PlanX developer."})]}):t.jsx(Hi,{children:t.jsxs(xi,{stickyHeader:!0,sx:{tableLayout:"fixed"},children:[t.jsx(yi,{children:t.jsxs(_n,{sx:{"& > *":{borderBottomColor:"black !important"}},children:[t.jsx(ie,{sx:{width:250},children:t.jsx("strong",{children:"Event"})}),t.jsx(ie,{sx:{width:130},children:t.jsx("strong",{children:"Status"})}),t.jsx(ie,{sx:{width:120},children:t.jsx("strong",{children:"Date"})}),t.jsx(ie,{sx:{width:350},children:t.jsx("strong",{children:"Session ID"})}),t.jsx(ie,{sx:{width:60}})]})}),t.jsx(bi,{children:e.map((r,i)=>T.createElement(Gi,{...r,key:i}))})]})}),Gi=e=>{const[n,a]=T.useState(!1);return t.jsxs(on.Fragment,{children:[t.jsxs(_n,{sx:{"& > *":{borderBottom:"unset"}},children:[t.jsx(ie,{children:t.jsxs(b,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.eventType==="Pay"?t.jsx(ca,{}):t.jsx(dr,{}),t.jsxs(I,{variant:"body2",ml:1,children:[e.eventType," ",e.retry&&" [Retry]"]})]})}),t.jsx(ie,{children:e.status==="Success"?t.jsx(bt,{label:"Success",size:"small",color:"success"}):t.jsx(bt,{label:e.status,size:"small",color:"error"})}),t.jsx(ie,{children:Fr(new Date(e.createdAt),"dd/MM/yy hh:mm:ss")}),t.jsx(ie,{children:e.sessionId}),t.jsx(ie,{children:t.jsx(Ke,{"aria-label":"expand row",size:"small",onClick:()=>a(!n),children:n?t.jsx(da,{}):t.jsx(Jt,{})})})]}),t.jsx(_n,{sx:{background:r=>r.palette.background.paper},children:t.jsx(ie,{sx:{padding:0,border:"none"},colSpan:5,children:t.jsx(zn,{in:n,timeout:"auto",unmountOnExit:!0,sx:{borderBottom:r=>`1px solid ${r.palette.border.light}`,padding:r=>r.spacing(0,1.5)},children:t.jsx(Yi,{...e})})})})]},`${e.eventId}-${e.createdAt}`)},Yi=e=>{var n,a,r,i;return e.eventType==="Pay"?t.jsx(jt,{component:"pre",children:JSON.stringify(e.response,null,2)}):t.jsx(jt,{component:"pre",children:e.status==="Success"?JSON.stringify(JSON.parse((a=(n=e.response)==null?void 0:n.data)==null?void 0:a.body),null,2):JSON.stringify(JSON.parse((i=(r=e.response)==null?void 0:r.data)==null?void 0:i.message),null,2)})},ua=()=>{const e=N(o=>o.id),{data:n,loading:a,error:r}=cr(He`
      query GetSubmissions($flow_id: uuid!) {
        submissions: submission_services_log(
          where: { flow_id: { _eq: $flow_id } }
          order_by: { created_at: asc }
        ) {
          sessionId: session_id
          eventId: event_id
          eventType: event_type
          status: status
          retry: retry
          response: response
          createdAt: created_at
        }
      }
    `,{variables:{flow_id:e},skip:!e}),i=T.useMemo(()=>(n==null?void 0:n.submissions)||[],[n]);return t.jsx(Vt,{maxWidth:"contentWrap",children:t.jsxs(b,{children:[t.jsxs(ce,{children:[t.jsx(I,{variant:"h2",component:"h3",gutterBottom:!0,children:"Submissions"}),t.jsx(I,{variant:"body1",children:"Feed of payment and submission events for this service"})]}),t.jsx(ce,{children:t.jsx(Wi,{submissions:i,loading:a,error:r})})]})})};var Hn={},Ji=Q;Object.defineProperty(Hn,"__esModule",{value:!0});var ha=Hn.default=void 0,Ki=Ji(X()),Xi=t,Qi=(0,Ki.default)((0,Xi.jsx)("path",{d:"M3 10h11v2H3v-2zm0-2h11V6H3v2zm0 8h7v-2H3v2zm15.01-3.13.71-.71c.39-.39 1.02-.39 1.41 0l.71.71c.39.39.39 1.02 0 1.41l-.71.71-2.12-2.12zm-.71.71-5.3 5.3V21h2.12l5.3-5.3-2.12-2.12z"}),"EditNote");ha=Hn.default=Qi;var Wn={},Zi=Q;Object.defineProperty(Wn,"__esModule",{value:!0});var $n=Wn.default=void 0,eo=Zi(X()),no=t,to=(0,eo.default)((0,no.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"}),"Language");$n=Wn.default=to;var Gn={},ao=Q;Object.defineProperty(Gn,"__esModule",{value:!0});var pa=Gn.default=void 0,ro=ao(X()),io=t,oo=(0,ro.default)((0,io.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew");pa=Gn.default=oo;var Yn={},lo=Q;Object.defineProperty(Yn,"__esModule",{value:!0});var fa=Yn.default=void 0,so=lo(X()),co=t,uo=(0,so.default)((0,co.jsx)("path",{d:"M16.79 5.8 14 3h7v7l-2.79-2.8-4.09 4.09-1.41-1.41 4.08-4.08zM19 12v4.17l2 2V12h-2zm.78 10.61L18.17 21H5c-1.11 0-2-.9-2-2V5.83L1.39 4.22 2.8 2.81l18.38 18.38-1.4 1.42zM16.17 19l-4.88-4.88-1.59 1.59-1.41-1.41 1.59-1.59L5 7.83V19h11.17zM7.83 5H12V3H5.83l2 2z"}),"OpenInNewOff");fa=Yn.default=uo;var Jn={},ho=Q;Object.defineProperty(Jn,"__esModule",{value:!0});var va=Jn.default=void 0,po=ho(X()),fo=t,vo=(0,po.default)((0,fo.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");va=Jn.default=vo;var Kn={},mo=Q;Object.defineProperty(Kn,"__esModule",{value:!0});var Pn=Kn.default=void 0,go=mo(X()),xo=t,yo=(0,go.default)((0,xo.jsx)("path",{d:"M17 4h3v16h-3zM5 14h3v6H5zm6-5h3v11h-3z"}),"SignalCellularAlt");Pn=Kn.default=yo;function bo(e){return Lt("MuiBadge",e)}const be=Et("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),jo=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],mn=10,gn=4,Co=e=>{const{color:n,anchorOrigin:a,invisible:r,overlap:i,variant:o,classes:l={}}=e,s={root:["root"],badge:["badge",o,r&&"invisible",`anchorOrigin${B(a.vertical)}${B(a.horizontal)}`,`anchorOrigin${B(a.vertical)}${B(a.horizontal)}${B(i)}`,`overlap${B(i)}`,n!=="default"&&`color${B(n)}`]};return $e(s,bo,l)},wo=$("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,n)=>n.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),So=$("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,n)=>{const{ownerState:a}=e;return[n.badge,n[a.variant],n[`anchorOrigin${B(a.anchorOrigin.vertical)}${B(a.anchorOrigin.horizontal)}${B(a.overlap)}`],a.color!=="default"&&n[`color${B(a.color)}`],a.invisible&&n.invisible]}})(({theme:e})=>{var n;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:mn*2,lineHeight:1,padding:"0 6px",height:mn*2,borderRadius:mn,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen}),variants:[...Object.keys(((n=e.vars)!=null?n:e).palette).filter(a=>{var r,i;return((r=e.vars)!=null?r:e).palette[a].main&&((i=e.vars)!=null?i:e).palette[a].contrastText}).map(a=>({props:{color:a},style:{backgroundColor:(e.vars||e).palette[a].main,color:(e.vars||e).palette[a].contrastText}})),{props:{variant:"dot"},style:{borderRadius:gn,height:gn*2,minWidth:gn*2,padding:0}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${be.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${be.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${be.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${be.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${be.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${be.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${be.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${be.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}]}}),To=T.forwardRef(function(n,a){var r,i,o,l,s,d;const p=Ie({props:n,name:"MuiBadge"}),{anchorOrigin:v={vertical:"top",horizontal:"right"},className:f,component:x,components:C={},componentsProps:m={},children:h,overlap:y="rectangular",color:w="default",invisible:j=!1,max:E=99,badgeContent:W,slots:U,slotProps:q,showZero:J=!1,variant:G="standard"}=p,Z=_e(p,jo),{badgeContent:Y,invisible:ee,max:S,displayValue:A}=Ti({max:E,invisible:j,badgeContent:W,showZero:J}),F=Si({anchorOrigin:v,color:w,overlap:y,variant:G,badgeContent:W}),xe=ee||Y==null&&G!=="dot",{color:Pe=w,overlap:Re=y,anchorOrigin:ke=v,variant:P=G}=xe?F:p,z=P!=="dot"?A:void 0,oe=L({},p,{badgeContent:Y,invisible:xe,max:S,displayValue:z,showZero:J,anchorOrigin:ke,color:Pe,overlap:Re,variant:P}),ye=Co(oe),Fe=(r=(i=U==null?void 0:U.root)!=null?i:C.Root)!=null?r:wo,Oe=(o=(l=U==null?void 0:U.badge)!=null?l:C.Badge)!=null?o:So,ne=(s=q==null?void 0:q.root)!=null?s:m.root,De=(d=q==null?void 0:q.badge)!=null?d:m.badge,nr=ht({elementType:Fe,externalSlotProps:ne,externalForwardedProps:Z,additionalProps:{ref:a,as:x},ownerState:oe,className:ve(ne==null?void 0:ne.className,ye.root,f)}),tr=ht({elementType:Oe,externalSlotProps:De,ownerState:oe,className:ve(ye.badge,De==null?void 0:De.className)});return t.jsxs(Fe,L({},nr,{children:[h,t.jsx(Oe,L({},tr,{children:z}))]}))});var Xn={},Io=Q;Object.defineProperty(Xn,"__esModule",{value:!0});var ma=Xn.default=void 0,_o=Io(X()),$o=t,Po=(0,_o.default)((0,$o.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l4 3.99L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.25 2.52.77-1.28-3.52-2.09V8z"}),"RestoreOutlined");ma=Xn.default=Po;const dn=T.createContext({});function Ro(e){return We("MuiTimeline",e)}Ve("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function Ye(e){return e==="alternate-reverse"?"positionAlternateReverse":`position${B(e)}`}const ko=["position","className"],Fo=e=>{const{position:n,classes:a}=e,r={root:["root",n&&Ye(n)]};return $e(r,Ro,a)},Oo=$("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:a}=e;return[n.root,a.position&&n[Ye(a.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),Do=T.forwardRef(function(n,a){const r=Ie({props:n,name:"MuiTimeline"}),{position:i="right",className:o}=r,l=_e(r,ko),s=L({},r,{position:i}),d=Fo(s),p=T.useMemo(()=>({position:i}),[i]);return t.jsx(dn.Provider,{value:p,children:t.jsx(Oo,L({className:ve(d.root,o),ownerState:s,ref:a},l))})});function Ao(e){return We("MuiTimelineConnector",e)}Ve("MuiTimelineConnector",["root"]);const Mo=["className"],Eo=e=>{const{classes:n}=e;return $e({root:["root"]},Ao,n)},Lo=$("span",{name:"MuiTimelineConnector",slot:"Root",overridesResolver:(e,n)=>n.root})(({theme:e})=>({width:2,backgroundColor:(e.vars||e).palette.grey[400],flexGrow:1})),No=T.forwardRef(function(n,a){const r=Ie({props:n,name:"MuiTimelineConnector"}),{className:i}=r,o=_e(r,Mo),l=r,s=Eo(l);return t.jsx(Lo,L({className:ve(s.root,i),ownerState:l,ref:a},o))});function Vo(e){return We("MuiTimelineContent",e)}const zo=Ve("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),Bo=["className"],Uo=e=>{const{position:n,classes:a}=e,r={root:["root",Ye(n)]};return $e(r,Vo,a)},qo=$(I,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:a}=e;return[n.root,n[Ye(a.position)]]}})(({ownerState:e})=>L({flex:1,padding:"6px 16px",textAlign:"left"},e.position==="left"&&{textAlign:"right"})),Ho=T.forwardRef(function(n,a){const r=Ie({props:n,name:"MuiTimelineContent"}),{className:i}=r,o=_e(r,Bo),{position:l}=T.useContext(dn),s=L({},r,{position:l||"right"}),d=Uo(s);return t.jsx(qo,L({component:"div",className:ve(d.root,i),ownerState:s,ref:a},o))});function Wo(e){return We("MuiTimelineDot",e)}Ve("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const Go=["className","color","variant"],Yo=e=>{const{color:n,variant:a,classes:r}=e,i={root:["root",a,n!=="inherit"&&`${a}${B(n)}`]};return $e(i,Wo,r)},Jo=$("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:a}=e;return[n.root,n[a.color!=="inherit"&&`${a.variant}${B(a.color)}`],n[a.variant]]}})(({ownerState:e,theme:n})=>L({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(n.vars||n).shadows[1],margin:"11.5px 0"},e.variant==="filled"&&L({borderColor:"transparent"},e.color!=="inherit"&&L({},e.color==="grey"?{color:(n.vars||n).palette.grey[50],backgroundColor:(n.vars||n).palette.grey[400]}:{color:(n.vars||n).palette[e.color].contrastText,backgroundColor:(n.vars||n).palette[e.color].main})),e.variant==="outlined"&&L({boxShadow:"none",backgroundColor:"transparent"},e.color!=="inherit"&&L({},e.color==="grey"?{borderColor:(n.vars||n).palette.grey[400]}:{borderColor:(n.vars||n).palette[e.color].main})))),Ko=T.forwardRef(function(n,a){const r=Ie({props:n,name:"MuiTimelineDot"}),{className:i,color:o="grey",variant:l="filled"}=r,s=_e(r,Go),d=L({},r,{color:o,variant:l}),p=Yo(d);return t.jsx(Jo,L({className:ve(p.root,i),ownerState:d,ref:a},s))}),Xo=Ve("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function Qo(e){return We("MuiTimelineItem",e)}const Zo=Ve("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]),el=["position","className"],nl=e=>{const{position:n,classes:a,hasOppositeContent:r}=e,i={root:["root",Ye(n),!r&&"missingOppositeContent"]};return $e(i,Qo,a)},tl=$("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:a}=e;return[n.root,n[Ye(a.position)]]}})(({ownerState:e})=>L({listStyle:"none",display:"flex",position:"relative",minHeight:70},e.position==="left"&&{flexDirection:"row-reverse"},(e.position==="alternate"||e.position==="alternate-reverse")&&{[`&:nth-of-type(${e.position==="alternate"?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${zo.root}`]:{textAlign:"right"},[`& .${Xo.root}`]:{textAlign:"left"}}},!e.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}})),al=T.forwardRef(function(n,a){const r=Ie({props:n,name:"MuiTimelineItem"}),{position:i,className:o}=r,l=_e(r,el),{position:s}=T.useContext(dn);let d=!1;T.Children.forEach(r.children,x=>{ur(x,["TimelineOppositeContent"])&&(d=!0)});const p=L({},r,{position:i||s||"right",hasOppositeContent:d}),v=nl(p),f=T.useMemo(()=>({position:p.position}),[p.position]);return t.jsx(dn.Provider,{value:f,children:t.jsx(tl,L({className:ve(v.root,o),ownerState:p,ref:a},l))})});function rl(e){return We("MuiTimelineSeparator",e)}Ve("MuiTimelineSeparator",["root"]);const il=["className"],ol=e=>{const{classes:n}=e;return $e({root:["root"]},rl,n)},ll=$("div",{name:"MuiTimelineSeparator",slot:"Root",overridesResolver:(e,n)=>n.root})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),sl=T.forwardRef(function(n,a){const r=Ie({props:n,name:"MuiTimelineSeparator"}),{className:i}=r,o=_e(r,il),l=r,s=ol(l);return t.jsx(ll,L({className:ve(s.root,i),ownerState:l,ref:a},o))}),Rn=e=>aa(new Date(e),{includeSeconds:!0,addSuffix:!0}),dl=(e,n)=>{if(!n)return`Last edited ${Rn(e)}`;const a=`${n.firstName} ${n.lastName}`;return`Last edited ${Rn(e)} by ${a}`},cl=$(({className:e,...n})=>t.jsx(se,{...n,placement:"left-start",classes:{popper:e}}))(({theme:e})=>({[`& .${Sn.tooltip}`]:{backgroundColor:e.palette.background.dark,fontSize:"0.8em",borderRadius:0,fontWeight:un}})),Ct=$("li")(()=>({listStyleType:"square",overflowWrap:"break-word",wordWrap:"break-word"})),ul=()=>{var C;const[n,a]=T.useState(void 0),[r,i,o,l,s]=N(m=>[m.id,m.flow,m.canUserEditTeam,m.teamSlug,m.undoOperation]),{data:d,loading:p,error:v}=ra(He`
      subscription GetRecentOperations($flow_id: uuid = "") {
        operations(
          limit: 15
          where: { flow_id: { _eq: $flow_id } }
          order_by: { created_at: desc }
        ) {
          id
          createdAt: created_at
          actor {
            id
            firstName: first_name
            lastName: last_name
          }
          data(path: "op")
        }
      }
    `,{variables:{flow_id:r}});if(v)return console.log(v.message),null;if(!p&&!(d!=null&&d.operations))return null;const f=m=>{var j;const h=(j=d==null?void 0:d.operations)==null?void 0:j.slice(0,m+1),y=[];h==null||h.map(E=>y.unshift(E==null?void 0:E.data));const w=y==null?void 0:y.flat(1);s(w)},x=m=>n!==void 0&&m<n;return t.jsx(b,{children:p&&!d?t.jsx(Nt,{msDelayBeforeVisible:0,text:"Fetching edit history..."}):t.jsxs(t.Fragment,{children:[t.jsx(Do,{sx:{padding:0,[`& .${Zo.root}:before`]:{flex:0,padding:0}},children:(C=d==null?void 0:d.operations)==null?void 0:C.map((m,h)=>{var y,w;return t.jsxs(al,{children:[t.jsxs(sl,{children:[t.jsx(Ko,{sx:{bgcolor:j=>x(h)?j.palette.grey[400]:j.palette.grey[900]}}),h<d.operations.length-1&&t.jsx(No,{sx:{bgcolor:j=>x(h)?j.palette.grey[400]:j.palette.grey[900]}})]}),t.jsxs(Ho,{sx:{paddingRight:0,minWidth:"100%",maxWidth:"100%"},children:[t.jsxs(b,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(b,{children:[t.jsx(I,{variant:"body1",sx:{fontWeight:un},color:x(h)?"GrayText":"inherit",children:`${m.actor?`Edited by ${(y=m.actor)==null?void 0:y.firstName} ${(w=m.actor)==null?void 0:w.lastName}`:"Created flow"}`}),t.jsx(I,{variant:"body2",color:x(h)?"GrayText":"inherit",children:Rn(m.createdAt)})]}),h>0&&m.actor&&o(l)&&t.jsx(cl,{title:"Restore to this point",children:t.jsx(Ke,{"aria-label":"Restore to this point",onClick:()=>f(h),onMouseEnter:()=>a(h),onMouseLeave:()=>a(void 0),children:t.jsx(ma,{fontSize:"large",color:x(h)?"inherit":"primary"})})})]}),m.data&&t.jsxs(t.Fragment,{children:[t.jsx(I,{variant:"body2",component:"ul",padding:2,color:x(h)?"GrayText":"inherit",style:{paddingRight:"50px"},children:[...new Set(Qe(i,m.data))].slice(0,5).map((j,E)=>t.jsx(Ct,{children:j},E))}),[...new Set(Qe(i,m.data))].length>5&&t.jsx(Gr,{id:"edits-overflow",buttonText:{open:`Show ${[...new Set(Qe(i,m.data))].length-5} more`,closed:"Show less"},lightFontStyle:!0,children:t.jsx(I,{variant:"body2",component:"ul",padding:2,color:x(h)?"GrayText":"inherit",style:{paddingRight:"50px"},children:[...new Set(Qe(i,m.data))].slice(5).map((j,E)=>t.jsx(Ct,{children:j},E))})})]})]})]},m.id)})}),(d==null?void 0:d.operations.length)===15&&t.jsxs(t.Fragment,{children:[t.jsx(sn,{}),t.jsx(I,{variant:"body2",mt:2,color:"GrayText",children:"History shows the last 15 edits made to this service. If you have questions about restoring to an earlier point in time, please contact a PlanX developer."})]})]})})},hl=$(b)(()=>({overflow:"auto",padding:20,maxHeight:"50%"})),pl=$(b)(({theme:e})=>({position:"relative",top:"0",right:"0",bottom:"0",width:"500px",display:"flex",flexShrink:0,flexDirection:"column",borderLeft:`1px solid ${e.palette.border.main}`,background:e.palette.background.paper,"& iframe":{flex:"1"}})),wt=$(b)(()=>({overflow:"auto",flex:1,background:"#fff"})),fl=$("header")(({theme:e})=>({padding:e.spacing(1),"& input":{flex:"1",padding:"5px",marginRight:"5px",background:e.palette.common.white,border:"1px solid rgba(0, 0, 0, 0.2)"},"& svg":{cursor:"pointer",opacity:"0.7",margin:"6px 4px 1px 4px",fontSize:"1.2rem"}})),vl=$(b)(({theme:e})=>({position:"relative","&::after":{content:"''",position:"absolute",bottom:0,left:0,width:"100%",height:"1px",backgroundColor:e.palette.border.main},"& .MuiTabs-root":{minHeight:"0"},"& .MuiTabs-indicator":{display:"none"}})),St=$($r)(({theme:e})=>({position:"relative",zIndex:1,textTransform:"none",background:"transparent",border:"1px solid transparent",borderBottomColor:e.palette.border.main,color:e.palette.primary.main,fontWeight:"600",minHeight:"36px",margin:e.spacing(0,.5),marginBottom:"-1px",padding:"0.5em",[`&.${Pr.selected}`]:{background:e.palette.background.default,borderColor:e.palette.border.main,borderBottomColor:e.palette.common.white,color:e.palette.text.primary}})),ga=(e,n)=>`Last published ${aa(new Date(e))} ago by ${n}`,ml=()=>{const[e,n,a,r]=N(i=>[i.computePassport(),i.breadcrumbs,i.id,i.cachedBreadcrumbs]);return t.jsxs(hl,{borderTop:2,borderColor:"border.main",bgcolor:"background.paper",children:[t.jsx(I,{variant:"body2",children:t.jsx("a",{href:`http://localhost:7002/flows/${a}/download-schema`,target:"_blank",rel:"noopener noreferrer",children:"Download the flow schema"})}),t.jsx("pre",{children:JSON.stringify({passport:e,breadcrumbs:n,cachedBreadcrumbs:r},null,2)})]})},gl=e=>{const{node:n}=e;let a,r;return n.id==="_root"?a="Changed _root service by adding, deleting or re-ordering nodes":n.id==="0"?a="The entire _root service will be published for the first time":n.id&&Object.keys(n).length===1?a=`Deleted node ${n.id}`:n.type&&n.data?(a=`Added/edited ${c.ComponentType[n.type]}`,r=JSON.stringify(n.data,null,2)):a=`Added/edited ${c.ComponentType[n.type]}`,t.jsxs("li",{children:[t.jsx(I,{variant:"body2",children:a}),r&&t.jsx("pre",{style:{fontSize:".8em"},children:r})]},n.id)},xl=e=>{const{text:n,flowId:a,publishedFlowId:r,summary:i,publishedAt:o}=e,[l,s]=T.useState(),d=N(p=>p.lastPublisher);return In(async()=>{const p=await d(a);s(ga(o,p))}),t.jsx(Jr,{disablePadding:!0,sx:{display:"list-item"},children:t.jsx(Ar,{primary:N.getState().canUserEditTeam(n.split("/")[0])?t.jsx(de,{href:`../${n}`,target:"_blank",children:t.jsx(I,{variant:"body2",children:n})}):t.jsx(I,{variant:"body2",children:n}),secondary:t.jsxs(t.Fragment,{children:[t.jsx(I,{variant:"body2",fontSize:"small",children:l}),i&&t.jsx(I,{variant:"body2",fontSize:"small",children:i})]})})},r)},yl=e=>{const{alteredNodes:n,url:a}=e,[r,i]=T.useState(!1),o={title:"",portals:[],updated:0,deleted:0};return n.map(l=>{var s,d;return l.id==="0"?o.title="You are publishing the main service for the first time.":l.id&&Object.keys(l).length===1?o.deleted+=1:l.type===c.ComponentType.InternalPortal?(d=(s=l.data)==null?void 0:s.text)!=null&&d.includes("/")&&o.portals.push({...l.data,flowId:l.id}):l.type&&(o.updated+=1),o}),t.jsxs(b,{pb:2,children:[o.title&&t.jsx(I,{variant:"body2",pb:2,children:o.title}),(o.updated>0||o.deleted>0)&&t.jsxs(b,{pb:2,children:[t.jsxs("ul",{children:[t.jsx("li",{children:t.jsx(I,{variant:"body2",children:`${o.updated} nodes have been updated or added`})},"updated"),t.jsx("li",{children:t.jsx(I,{variant:"body2",children:`${o.deleted} nodes have been deleted`})},"deleted")]}),t.jsxs(b,{style:{display:"flex",flexDirection:"column",marginBottom:2},children:[t.jsxs(b,{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[t.jsx(I,{variant:"body2",children:"See detailed changelog "}),t.jsx(fe,{onClick:()=>i(l=>!l),size:"small",disableRipple:!0,children:t.jsx(Dr,{expanded:r,color:"primary",titleAccess:r?"Less information":"More information"})})]}),t.jsx(zn,{in:r,children:t.jsx(b,{pb:1,children:t.jsx("ul",{children:n.map(l=>t.jsx(gl,{node:l}))})})})]})]}),t.jsx(sn,{}),o.portals.length>0&&t.jsxs(b,{pt:2,children:[t.jsx(I,{variant:"body2",children:"This includes recently published changes in the following nested services:"}),t.jsx(hr,{sx:{listStyleType:"disc",marginLeft:4},children:o.portals.map(l=>t.jsx(xl,{...l}))})]}),t.jsx(sn,{}),t.jsx(b,{pt:2,children:t.jsxs(I,{variant:"body2",children:["Preview these content changes in-service before publishing ",t.jsx(de,{href:a.replace("/published","/preview"),target:"_blank",children:"here (opens in a new tab)."})]})})]})},bl=on.memo(e=>{const[n,a]=T.useState(!1),[r,i,o,l,s,d,p,v,f]=N(S=>{var A;return[S.id,S.flowAnalyticsLink,S.resetPreview,S.publishFlow,S.lastPublished,S.lastPublisher,S.validateAndDiffFlow,S.isFlowPublished,(A=S.user)==null?void 0:A.isPlatformAdmin]}),[x,C]=T.useState(!1),[m,h]=T.useState("This flow is not published yet"),[y,w]=T.useState(),[j,E]=T.useState(),[W,U]=T.useState(!1),[q,J]=T.useState(),[G,Z]=T.useState("PreviewBrowser"),Y=(S,A)=>{Z(A)};In(async()=>{const S=await s(r),A=await d(r);h(ga(S,A))}),In(async()=>{const S=await p(r);E(S!=null&&S.data.alteredNodes?S.data.alteredNodes:[])});const ee=window.location.pathname.split("/")[1];return t.jsxs(pl,{children:[t.jsxs(fl,{children:[t.jsxs(b,{width:"100%",display:"flex",children:[t.jsx("input",{type:"text",disabled:!0,value:e.url.replace("/published","/preview")}),t.jsx(se,{arrow:!0,title:"Refresh preview",children:t.jsx(va,{onClick:()=>{o(),C(S=>!S)}})}),t.jsx(se,{arrow:!0,title:"Toggle debug console",children:t.jsx(Or,{onClick:()=>a(!n)})}),i?t.jsx(se,{arrow:!0,title:"Open analytics page",children:t.jsx(de,{href:i,target:"_blank",rel:"noopener noreferrer",color:"inherit",children:t.jsx(Pn,{})})}):t.jsx(se,{arrow:!0,title:"Analytics page unavailable",children:t.jsx(b,{children:t.jsx(de,{component:"button",disabled:!0,"aria-disabled":!0,children:t.jsx(Pn,{})})})}),f&&t.jsx(se,{arrow:!0,title:"Open draft service",children:t.jsx(de,{href:e.url.replace("/published","/draft"),target:"_blank",rel:"noopener noreferrer",color:"inherit",children:t.jsx(fa,{})})}),t.jsx(se,{arrow:!0,title:"Open preview of changes to publish",children:t.jsx(de,{href:e.url.replace("/published","/preview"),target:"_blank",rel:"noopener noreferrer",color:"inherit",children:t.jsx(pa,{})})}),v?t.jsx(se,{arrow:!0,title:"Open published service",children:t.jsx(de,{href:e.url+"?analytics=false",target:"_blank",rel:"noopener noreferrer",color:"inherit",children:t.jsx($n,{})})}):t.jsx(se,{arrow:!0,title:"Flow not yet published",children:t.jsx(b,{children:t.jsx(de,{component:"button",disabled:!0,"aria-disabled":!0,children:t.jsx($n,{})})})})]}),t.jsx(b,{width:"100%",mt:2,children:t.jsxs(b,{display:"flex",flexDirection:"column",alignItems:"flex-end",marginRight:1,children:[t.jsx(To,{sx:{width:"100%"},badgeContent:j&&j.length,max:999,color:"warning",children:t.jsx(fe,{sx:{width:"100%"},variant:"contained",color:"primary",disabled:!N.getState().canUserEditTeam(ee),onClick:async()=>{var S,A;try{h("Checking for changes...");const F=await p(r);E(F!=null&&F.data.alteredNodes?F.data.alteredNodes:[]),h(F!=null&&F.data.alteredNodes?`Found changes to ${F.data.alteredNodes.length} node(s)`:F==null?void 0:F.data.message),w(F==null?void 0:F.data.description),U(!0)}catch(F){h("Error checking for changes to publish"),F instanceof ji?alert((A=(S=F.response)==null?void 0:S.data)==null?void 0:A.error):alert(`Error checking for changes to publish. Confirm that your graph does not have any corrupted nodes and that all external portals are valid. 
${F}`)}},children:"CHECK FOR CHANGES TO PUBLISH"})}),t.jsxs(Kt,{open:W,onClose:()=>U(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[t.jsx(Xt,{style:{paddingBottom:0},children:m}),t.jsx(Qt,{children:j!=null&&j.length?t.jsxs(t.Fragment,{children:[t.jsx(yl,{alteredNodes:j,url:e.url}),t.jsx(g,{bordered:!0,type:"text",name:"summary",value:q||"",placeholder:"Summarise your changes...",onChange:S=>J(S.target.value)})]}):y||m}),t.jsxs(Zt,{children:[t.jsx(fe,{onClick:()=>U(!1),children:"KEEP EDITING"}),t.jsx(fe,{color:"primary",onClick:async()=>{try{U(!1),h("Publishing changes...");const{alteredNodes:S,message:A}=await l(r,q);h(S?`Successfully published changes to ${S.length} node(s)`:`${A}`||"No new changes to publish")}catch(S){h("Error trying to publish"),alert(S),console.log(S)}},disabled:!j||j.length===0,children:"PUBLISH"})]})]}),t.jsx(b,{mr:0,children:t.jsx(I,{variant:"caption",children:m})})]})})]}),t.jsx(vl,{children:t.jsxs(Rr,{centered:!0,onChange:Y,value:G,"aria-label":"",children:[t.jsx(St,{disableFocusRipple:!0,disableTouchRipple:!0,disableRipple:!0,value:"PreviewBrowser",label:"Preview"}),t.jsx(St,{disableFocusRipple:!0,disableTouchRipple:!0,disableRipple:!0,value:"History",label:"History"})]})}),G==="PreviewBrowser"&&t.jsx(wt,{children:t.jsx(Yr,{previewEnvironment:"editor"},String(x))}),G==="History"&&t.jsx(wt,{py:3,children:t.jsx(Vt,{children:t.jsx(ul,{})})}),n&&t.jsx(ml,{})]})});function M(e){return typeof e=="function"}function jl(e){var n=function(r){Error.call(r),r.stack=new Error().stack},a=e(n);return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}var xn=jl(function(e){return function(a){e(this),this.message=a?a.length+` errors occurred during unsubscription:
`+a.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=a}});function kn(e,n){if(e){var a=e.indexOf(n);0<=a&&e.splice(a,1)}}var pn=function(){function e(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var n,a,r,i,o;if(!this.closed){this.closed=!0;var l=this._parentage;if(l)if(this._parentage=null,Array.isArray(l))try{for(var s=Tn(l),d=s.next();!d.done;d=s.next()){var p=d.value;p.remove(this)}}catch(h){n={error:h}}finally{try{d&&!d.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}else l.remove(this);var v=this.initialTeardown;if(M(v))try{v()}catch(h){o=h instanceof xn?h.errors:[h]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var x=Tn(f),C=x.next();!C.done;C=x.next()){var m=C.value;try{Tt(m)}catch(h){o=o??[],h instanceof xn?o=Je(Je([],qe(o)),qe(h.errors)):o.push(h)}}}catch(h){r={error:h}}finally{try{C&&!C.done&&(i=x.return)&&i.call(x)}finally{if(r)throw r.error}}}if(o)throw new xn(o)}},e.prototype.add=function(n){var a;if(n&&n!==this)if(this.closed)Tt(n);else{if(n instanceof e){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(a=this._finalizers)!==null&&a!==void 0?a:[]).push(n)}},e.prototype._hasParent=function(n){var a=this._parentage;return a===n||Array.isArray(a)&&a.includes(n)},e.prototype._addParent=function(n){var a=this._parentage;this._parentage=Array.isArray(a)?(a.push(n),a):a?[a,n]:n},e.prototype._removeParent=function(n){var a=this._parentage;a===n?this._parentage=null:Array.isArray(a)&&kn(a,n)},e.prototype.remove=function(n){var a=this._finalizers;a&&kn(a,n),n instanceof e&&n._removeParent(this)},e.EMPTY=function(){var n=new e;return n.closed=!0,n}(),e}();pn.EMPTY;function xa(e){return e instanceof pn||e&&"closed"in e&&M(e.remove)&&M(e.add)&&M(e.unsubscribe)}function Tt(e){M(e)?e():e.unsubscribe()}var ya={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ba={setTimeout:function(e,n){for(var a=[],r=2;r<arguments.length;r++)a[r-2]=arguments[r];return setTimeout.apply(void 0,Je([e,n],qe(a)))},clearTimeout:function(e){var n=ba.delegate;return((n==null?void 0:n.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ja(e){ba.setTimeout(function(){throw e})}function Fn(){}function Cl(e){e()}var Qn=function(e){Ge(n,e);function n(a){var r=e.call(this)||this;return r.isStopped=!1,a?(r.destination=a,xa(a)&&a.add(r)):r.destination=Il,r}return n.create=function(a,r,i){return new On(a,r,i)},n.prototype.next=function(a){this.isStopped||this._next(a)},n.prototype.error=function(a){this.isStopped||(this.isStopped=!0,this._error(a))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(a){this.destination.next(a)},n.prototype._error=function(a){try{this.destination.error(a)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(pn),wl=Function.prototype.bind;function yn(e,n){return wl.call(e,n)}var Sl=function(){function e(n){this.partialObserver=n}return e.prototype.next=function(n){var a=this.partialObserver;if(a.next)try{a.next(n)}catch(r){Ze(r)}},e.prototype.error=function(n){var a=this.partialObserver;if(a.error)try{a.error(n)}catch(r){Ze(r)}else Ze(n)},e.prototype.complete=function(){var n=this.partialObserver;if(n.complete)try{n.complete()}catch(a){Ze(a)}},e}(),On=function(e){Ge(n,e);function n(a,r,i){var o=e.call(this)||this,l;if(M(a)||!a)l={next:a??void 0,error:r??void 0,complete:i??void 0};else{var s;o&&ya.useDeprecatedNextContext?(s=Object.create(a),s.unsubscribe=function(){return o.unsubscribe()},l={next:a.next&&yn(a.next,s),error:a.error&&yn(a.error,s),complete:a.complete&&yn(a.complete,s)}):l=a}return o.destination=new Sl(l),o}return n}(Qn);function Ze(e){ja(e)}function Tl(e){throw e}var Il={closed:!0,next:Fn,error:Tl,complete:Fn},Zn=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function et(e){return e}function _l(e){return e.length===0?et:e.length===1?e[0]:function(a){return e.reduce(function(r,i){return i(r)},a)}}var re=function(){function e(n){n&&(this._subscribe=n)}return e.prototype.lift=function(n){var a=new e;return a.source=this,a.operator=n,a},e.prototype.subscribe=function(n,a,r){var i=this,o=Pl(n)?n:new On(n,a,r);return Cl(function(){var l=i,s=l.operator,d=l.source;o.add(s?s.call(o,d):d?i._subscribe(o):i._trySubscribe(o))}),o},e.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(a){n.error(a)}},e.prototype.forEach=function(n,a){var r=this;return a=It(a),new a(function(i,o){var l=new On({next:function(s){try{n(s)}catch(d){o(d),l.unsubscribe()}},error:o,complete:i});r.subscribe(l)})},e.prototype._subscribe=function(n){var a;return(a=this.source)===null||a===void 0?void 0:a.subscribe(n)},e.prototype[Zn]=function(){return this},e.prototype.pipe=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return _l(n)(this)},e.prototype.toPromise=function(n){var a=this;return n=It(n),new n(function(r,i){var o;a.subscribe(function(l){return o=l},function(l){return i(l)},function(){return r(o)})})},e.create=function(n){return new e(n)},e}();function It(e){var n;return(n=e??ya.Promise)!==null&&n!==void 0?n:Promise}function $l(e){return e&&M(e.next)&&M(e.error)&&M(e.complete)}function Pl(e){return e&&e instanceof Qn||$l(e)&&xa(e)}function Rl(e){return M(e==null?void 0:e.lift)}function ue(e){return function(n){if(Rl(n))return n.lift(function(a){try{return e(a,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function te(e,n,a,r,i){return new kl(e,n,a,r,i)}var kl=function(e){Ge(n,e);function n(a,r,i,o,l,s){var d=e.call(this,a)||this;return d.onFinalize=l,d.shouldUnsubscribe=s,d._next=r?function(p){try{r(p)}catch(v){a.error(v)}}:e.prototype._next,d._error=o?function(p){try{o(p)}catch(v){a.error(v)}finally{this.unsubscribe()}}:e.prototype._error,d._complete=i?function(){try{i()}catch(p){a.error(p)}finally{this.unsubscribe()}}:e.prototype._complete,d}return n.prototype.unsubscribe=function(){var a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((a=this.onFinalize)===null||a===void 0||a.call(this))}},n}(Qn),Fl={now:function(){return Date.now()},delegate:void 0},Ol=function(e){Ge(n,e);function n(a,r){return e.call(this)||this}return n.prototype.schedule=function(a,r){return this},n}(pn),Dn={setInterval:function(e,n){for(var a=[],r=2;r<arguments.length;r++)a[r-2]=arguments[r];return setInterval.apply(void 0,Je([e,n],qe(a)))},clearInterval:function(e){var n=Dn.delegate;return((n==null?void 0:n.clearInterval)||clearInterval)(e)},delegate:void 0},Dl=function(e){Ge(n,e);function n(a,r){var i=e.call(this,a,r)||this;return i.scheduler=a,i.work=r,i.pending=!1,i}return n.prototype.schedule=function(a,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=a;var o=this.id,l=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(l,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(l,this.id,r),this},n.prototype.requestAsyncId=function(a,r,i){return i===void 0&&(i=0),Dn.setInterval(a.flush.bind(a,this),i)},n.prototype.recycleAsyncId=function(a,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Dn.clearInterval(r)},n.prototype.execute=function(a,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(a,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(a,r){var i=!1,o;try{this.work(a)}catch(l){i=!0,o=l||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},n.prototype.unsubscribe=function(){if(!this.closed){var a=this,r=a.id,i=a.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,kn(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},n}(Ol),_t=function(){function e(n,a){a===void 0&&(a=e.now),this.schedulerActionCtor=n,this.now=a}return e.prototype.schedule=function(n,a,r){return a===void 0&&(a=0),new this.schedulerActionCtor(this,n).schedule(r,a)},e.now=Fl.now,e}(),Al=function(e){Ge(n,e);function n(a,r){r===void 0&&(r=_t.now);var i=e.call(this,a,r)||this;return i.actions=[],i._active=!1,i}return n.prototype.flush=function(a){var r=this.actions;if(this._active){r.push(a);return}var i;this._active=!0;do if(i=a.execute(a.state,a.delay))break;while(a=r.shift());if(this._active=!1,i){for(;a=r.shift();)a.unsubscribe();throw i}},n}(_t),Ca=new Al(Dl),Ml=Ca,El=new re(function(e){return e.complete()});function wa(e){return e&&M(e.schedule)}function Sa(e){return e[e.length-1]}function Ll(e){return wa(Sa(e))?e.pop():void 0}function Nl(e,n){return typeof Sa(e)=="number"?e.pop():n}var nt=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Ta(e){return M(e==null?void 0:e.then)}function Ia(e){return M(e[Zn])}function _a(e){return Symbol.asyncIterator&&M(e==null?void 0:e[Symbol.asyncIterator])}function $a(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Vl(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Pa=Vl();function Ra(e){return M(e==null?void 0:e[Pa])}function ka(e){return pr(this,arguments,function(){var a,r,i,o;return zt(this,function(l){switch(l.label){case 0:a=e.getReader(),l.label=1;case 1:l.trys.push([1,,9,10]),l.label=2;case 2:return[4,fn(a.read())];case 3:return r=l.sent(),i=r.value,o=r.done,o?[4,fn(void 0)]:[3,5];case 4:return[2,l.sent()];case 5:return[4,fn(i)];case 6:return[4,l.sent()];case 7:return l.sent(),[3,2];case 8:return[3,10];case 9:return a.releaseLock(),[7];case 10:return[2]}})})}function Fa(e){return M(e==null?void 0:e.getReader)}function he(e){if(e instanceof re)return e;if(e!=null){if(Ia(e))return zl(e);if(nt(e))return Bl(e);if(Ta(e))return Ul(e);if(_a(e))return Oa(e);if(Ra(e))return ql(e);if(Fa(e))return Hl(e)}throw $a(e)}function zl(e){return new re(function(n){var a=e[Zn]();if(M(a.subscribe))return a.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Bl(e){return new re(function(n){for(var a=0;a<e.length&&!n.closed;a++)n.next(e[a]);n.complete()})}function Ul(e){return new re(function(n){e.then(function(a){n.closed||(n.next(a),n.complete())},function(a){return n.error(a)}).then(null,ja)})}function ql(e){return new re(function(n){var a,r;try{for(var i=Tn(e),o=i.next();!o.done;o=i.next()){var l=o.value;if(n.next(l),n.closed)return}}catch(s){a={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}n.complete()})}function Oa(e){return new re(function(n){Wl(e,n).catch(function(a){return n.error(a)})})}function Hl(e){return Oa(ka(e))}function Wl(e,n){var a,r,i,o;return fr(this,void 0,void 0,function(){var l,s;return zt(this,function(d){switch(d.label){case 0:d.trys.push([0,5,6,11]),a=vr(e),d.label=1;case 1:return[4,a.next()];case 2:if(r=d.sent(),!!r.done)return[3,4];if(l=r.value,n.next(l),n.closed)return[2];d.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=d.sent(),i={error:s},[3,11];case 6:return d.trys.push([6,,9,10]),r&&!r.done&&(o=a.return)?[4,o.call(a)]:[3,8];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}function Le(e,n,a,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=n.schedule(function(){a(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function Da(e,n){return n===void 0&&(n=0),ue(function(a,r){a.subscribe(te(r,function(i){return Le(r,e,function(){return r.next(i)},n)},function(){return Le(r,e,function(){return r.complete()},n)},function(i){return Le(r,e,function(){return r.error(i)},n)}))})}function Aa(e,n){return n===void 0&&(n=0),ue(function(a,r){r.add(e.schedule(function(){return a.subscribe(r)},n))})}function Gl(e,n){return he(e).pipe(Aa(n),Da(n))}function Yl(e,n){return he(e).pipe(Aa(n),Da(n))}function Jl(e,n){return new re(function(a){var r=0;return n.schedule(function(){r===e.length?a.complete():(a.next(e[r++]),a.closed||this.schedule())})})}function Kl(e,n){return new re(function(a){var r;return Le(a,n,function(){r=e[Pa](),Le(a,n,function(){var i,o,l;try{i=r.next(),o=i.value,l=i.done}catch(s){a.error(s);return}l?a.complete():a.next(o)},0,!0)}),function(){return M(r==null?void 0:r.return)&&r.return()}})}function Ma(e,n){if(!e)throw new Error("Iterable cannot be null");return new re(function(a){Le(a,n,function(){var r=e[Symbol.asyncIterator]();Le(a,n,function(){r.next().then(function(i){i.done?a.complete():a.next(i.value)})},0,!0)})})}function Xl(e,n){return Ma(ka(e),n)}function Ql(e,n){if(e!=null){if(Ia(e))return Gl(e,n);if(nt(e))return Jl(e,n);if(Ta(e))return Yl(e,n);if(_a(e))return Ma(e,n);if(Ra(e))return Kl(e,n);if(Fa(e))return Xl(e,n)}throw $a(e)}function Zl(e,n){return n?Ql(e,n):he(e)}function es(e){return e instanceof Date&&!isNaN(e)}function tt(e,n){return ue(function(a,r){var i=0;a.subscribe(te(r,function(o){r.next(e.call(n,o,i++))}))})}var ns=Array.isArray;function ts(e,n){return ns(n)?e.apply(void 0,Je([],qe(n))):e(n)}function as(e){return tt(function(n){return ts(e,n)})}function rs(e,n,a,r,i,o,l,s){var d=[],p=0,v=0,f=!1,x=function(){f&&!d.length&&!p&&n.complete()},C=function(h){return p<r?m(h):d.push(h)},m=function(h){p++;var y=!1;he(a(h,v++)).subscribe(te(n,function(w){n.next(w)},function(){y=!0},void 0,function(){if(y)try{p--;for(var w=function(){var j=d.shift();l||m(j)};d.length&&p<r;)w();x()}catch(j){n.error(j)}}))};return e.subscribe(te(n,C,function(){f=!0,x()})),function(){}}function at(e,n,a){return a===void 0&&(a=1/0),M(n)?at(function(r,i){return tt(function(o,l){return n(r,o,i,l)})(he(e(r,i)))},a):(typeof n=="number"&&(a=n),ue(function(r,i){return rs(r,i,e,a)}))}function is(e){return e===void 0&&(e=1/0),at(et,e)}var os=["addListener","removeListener"],ls=["addEventListener","removeEventListener"],ss=["on","off"];function je(e,n,a,r){if(M(a)&&(r=a,a=void 0),r)return je(e,n,a).pipe(as(r));var i=qe(us(e)?ls.map(function(s){return function(d){return e[s](n,d,a)}}):ds(e)?os.map($t(e,n)):cs(e)?ss.map($t(e,n)):[],2),o=i[0],l=i[1];if(!o&&nt(e))return at(function(s){return je(s,n,a)})(he(e));if(!o)throw new TypeError("Invalid event target");return new re(function(s){var d=function(){for(var p=[],v=0;v<arguments.length;v++)p[v]=arguments[v];return s.next(1<p.length?p:p[0])};return o(d),function(){return l(d)}})}function $t(e,n){return function(a){return function(r){return e[a](n,r)}}}function ds(e){return M(e.addListener)&&M(e.removeListener)}function cs(e){return M(e.on)&&M(e.off)}function us(e){return M(e.addEventListener)&&M(e.removeEventListener)}function hs(e,n,a){a===void 0&&(a=Ml);var r=-1;return n!=null&&(wa(n)?a=n:r=n),new re(function(i){var o=es(e)?+e-a.now():e;o<0&&(o=0);var l=0;return a.schedule(function(){i.closed||(i.next(l++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function ps(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var a=Ll(e),r=Nl(e,1/0),i=e;return i.length?i.length===1?he(i[0]):is(r)(Zl(i,a)):El}function Pt(e,n){return ue(function(a,r){var i=0;a.subscribe(te(r,function(o){return e.call(n,o,i++)&&r.next(o)}))})}function fs(e,n,a,r,i){return function(o,l){var s=a,d=n,p=0;o.subscribe(te(l,function(v){var f=p++;d=s?e(d,v,f):(s=!0,v),l.next(d)},i))}}function vs(e,n){return n===void 0&&(n=et),e=e??ms,ue(function(a,r){var i,o=!0;a.subscribe(te(r,function(l){var s=n(l);(o||!e(i,s))&&(o=!1,i=s,r.next(l))}))})}function ms(e,n){return e===n}function gs(e,n){return ue(fs(e,n,arguments.length>=2,!0))}function Rt(e,n){return ue(function(a,r){var i=null,o=0,l=!1,s=function(){return l&&!i&&r.complete()};a.subscribe(te(r,function(d){i==null||i.unsubscribe();var p=0,v=o++;he(e(d,v)).subscribe(i=te(r,function(f){return r.next(n?n(d,f,v,p++):f)},function(){i=null,s()}))},function(){l=!0,s()}))})}function xs(e,n){return M(n)?Rt(function(){return e},n):Rt(function(){return e})}function ys(e){return ue(function(n,a){he(e).subscribe(te(a,function(){return a.complete()},Fn)),!a.closed&&n.subscribe(a)})}function bs(e,n){return ue(function(a,r){var i=n??{},o=i.leading,l=o===void 0?!0:o,s=i.trailing,d=s===void 0?!1:s,p=!1,v=null,f=null,x=!1,C=function(){f==null||f.unsubscribe(),f=null,d&&(y(),x&&r.complete())},m=function(){f=null,x&&r.complete()},h=function(w){return f=he(e(w)).subscribe(te(r,C,m))},y=function(){if(p){p=!1;var w=v;v=null,r.next(w),!x&&h(w)}};a.subscribe(te(r,function(w){p=!0,v=w,!(f&&!f.closed)&&(l?y():h(w))},function(){x=!0,!(d&&p&&f&&!f.closed)&&r.complete()}))})}function js(e,n,a){n===void 0&&(n=Ca);var r=hs(e,n);return bs(function(){return r},a)}const Cs=e=>{T.useEffect(()=>{let n,a;const r=["scrollPos",Ee(!0)].join(":"),i=e.current;if(i){const o=sessionStorage.getItem(r);if(o){const[f,x]=o.split(",").map(Number);i.scrollTo(f,x)}const l=je(i,"mousemove"),s=je(i,"mousedown"),d=ps(je(document,"blur"),je(document,"mouseup"),je(document,"mouseenter").pipe(Pt(f=>f.which===0))),p=s.pipe(Pt(f=>f.which===2));let v={};d.subscribe(()=>v={}),a=p.pipe(xs(l.pipe(gs((f,x)=>(f.scrollPos=v.scrollPos||[i.scrollLeft,i.scrollTop],f.initialPos=v.initialPos||[x.pageX,x.pageY],v=f,f.pos=[x.pageX,x.pageY],f),v),ys(d)))).subscribe(({initialPos:f,pos:x,scrollPos:C})=>{i.scrollTo(C[0]+f[0]-x[0],C[1]+f[1]-x[1])}),n=je(i,"scroll",{passive:!0}).pipe(js(250,void 0,{trailing:!0}),tt(f=>[f.target.scrollLeft,f.target.scrollTop].join(",")),vs()).subscribe(f=>{sessionStorage.setItem(r,f)})}return()=>{n==null||n.unsubscribe(),a==null||a.unsubscribe()}},[e])},ws=$(b)(()=>({display:"flex",alignItems:"stretch",overflow:"hidden",flexGrow:1})),Ss=()=>{const[e]=N(o=>[o.id]),{data:n,loading:a,error:r}=ra(He`
      subscription GetMostRecentOperation($flow_id: uuid = "") {
        operations(
          limit: 1
          where: { flow_id: { _eq: $flow_id } }
          order_by: { created_at: desc }
        ) {
          id
          createdAt: created_at
          actor {
            firstName: first_name
            lastName: last_name
          }
        }
      }
    `,{variables:{flow_id:e}});if(r)return console.log(r.message),null;if(n&&!n.operations[0].actor)return null;let i;if(a||!n)i="Loading...";else{const{operations:[o]}=n;i=dl(o==null?void 0:o.createdAt,o==null?void 0:o.actor)}return t.jsxs(b,{sx:o=>({backgroundColor:o.palette.grey[200],borderBottom:`1px solid ${o.palette.border.main}`,padding:o.spacing(.5,1),paddingLeft:o.spacing(2),display:"flex",alignItems:"center",[o.breakpoints.up("md")]:{paddingLeft:o.spacing(2)}}),children:[t.jsx(I,{variant:"body2",fontSize:"small",children:i}),t.jsxs(de,{variant:"body2",fontSize:"small",fontWeight:un,ml:2,sx:{display:"flex",alignItems:"center"},children:[t.jsx(ha,{})," View edit history"]})]})},kt=({flow:e,breadcrumbs:n})=>{const a=T.useRef(null);Cs(a);const r=N(i=>i.showSidebar);return t.jsxs(ws,{id:"editor-container",children:[t.jsxs(b,{sx:{display:"flex",flexDirection:"column",width:"100%",overflowX:"auto"},children:[t.jsx(Ss,{}),t.jsx(b,{id:"editor",ref:a,sx:{position:"relative"},children:t.jsx(mr,{flow:e,breadcrumbs:n})})]}),r&&t.jsx(bl,{url:`${window.location.origin}${Ee(!1)}/published`})]})};function Ts(e){var a;const n=D({initialValues:Kr((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.AddressInput,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Address Input",Icon:O[c.ComponentType.AddressInput],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",value:n.values.title,placeholder:"Title",onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Description",name:"description",value:n.values.description,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(g,{required:!0,format:"data",name:"fn",value:n.values.fn,placeholder:"Data Field",onChange:n.handleChange})})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const Is=$(gr,{shouldForwardProp:e=>!["selected","backgroundColor"].includes(e.toString())})(({theme:e,selected:n,backgroundColor:a})=>({height:50,padding:e.spacing(0,3,0,5),marginBottom:e.spacing(.5),fontSize:15,position:"relative",fontFamily:"inherit",display:"block",width:"auto",minWidth:200,textAlign:"left",border:`1px solid ${e.palette.border.light}`,backgroundColor:e.palette.common.white,"&::before":{content:"''",position:"absolute",height:12,width:12,left:18,top:18,borderRadius:"50%",backgroundColor:e.palette.grey[400],...n&&{color:"#fff",backgroundColor:a||e.palette.success.main}},...!n&&{"&:hover":{backgroundColor:"rgba(0,0,0,0.1)"}},...n&&{backgroundColor:e.palette.grey[200]}}));function ae(e){return t.jsx(Is,{...e,children:e.children})}const _s=$("span")(()=>({alignSelf:"center",margin:"auto 1rem",textAlign:"center"})),bn="unknown";function $s(e){var i;const n=D({initialValues:Xr((i=e.node)==null?void 0:i.data),onSubmit:o=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.Calculate,data:o})},validate:()=>{mt(n.values.formula)}}),a=on.useMemo(()=>{try{return[...mt(n.values.formula)]}catch{return[]}},[n.values.formula]),r=on.useMemo(()=>{try{const o=Qr(n.values.formula,n.values.samples,n.values.defaults);return typeof o=="number"?o:bn}catch{return bn}},[n.values.formula,n.values.defaults,n.values.samples]);return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsxs(k,{children:[t.jsxs(_,{title:"Calculate",Icon:O[c.ComponentType.Calculate],children:[t.jsxs(I,{variant:"body2",sx:{mb:2},children:["This component does math! Write formulas using"," ",t.jsx("a",{href:"https://mathjs.org/index.html",target:"_blank",children:"Math.js"}),", omitting the ",t.jsx("code",{children:"math."})," prefix"]}),t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:"Title",name:"title",value:n.values.title,onChange:n.handleChange})})]}),t.jsxs(_,{title:"Output",children:[t.jsx(u,{children:t.jsx(g,{required:!0,placeholder:"output data field",name:"output",format:"data",value:n.values.output,onChange:n.handleChange})}),t.jsx(ae,{selected:n.values.formatOutputForAutomations,onClick:()=>{n.setFieldValue("formatOutputForAutomations",!n.values.formatOutputForAutomations)},children:"Format the output to automate a future Question or Checklist only"})]}),t.jsx(_,{title:"Formula",children:t.jsx(u,{children:t.jsx(g,{required:!0,placeholder:"1+1",name:"formula",value:n.values.formula,onChange:n.handleChange,errorMessage:r===bn?"Invalid formula or missing default values.":""})})}),t.jsx(_,{title:"Default values",children:!a||a.length===0?t.jsx("p",{children:"No data fields found in formula."}):a.map(o=>t.jsx(me,{label:o,children:t.jsx(u,{children:t.jsx(g,{name:`defaults['${o}']`,value:n.values.defaults[o],onChange:n.handleChange,placeholder:"insert default value",required:!0})})},o))}),t.jsxs(_,{title:"Try",children:[a!=null&&a.length?t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"If"}),a.map(o=>t.jsxs(u,{children:[t.jsx(g,{value:o,disabled:!0}),t.jsx(_s,{children:"were"}),t.jsx(g,{name:`samples['${o}']`,value:n.values.samples[o],onChange:n.handleChange,placeholder:"empty"})]},o)),t.jsx("p",{children:"then"})]}):t.jsx(t.Fragment,{}),t.jsxs("p",{children:[t.jsx("strong",{children:n.values.output||"<output>"})," would be set to ",t.jsx("strong",{children:r}),"."]})]})]}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}function Ps(e,n){e=e||[],n=n||[];var a,r=e.length,i=n.length,o=[];for(a=0;a<r;)o[o.length]=e[a],a+=1;for(a=0;a<i;)o[o.length]=n[a],a+=1;return o}var Rs=Ps,ks=Rs,Fs=hn,Os=Fs(function(n,a,r){var i=r.length;if(n>=i||n<-i)return r;var o=(i+n)%i,l=ks(r);return l[o]=a(r[o]),l}),Ds=Os;const Ft=Mn(Ds);function As(e,n){switch(e){case 0:return function(){return n.apply(this,arguments)};case 1:return function(a){return n.apply(this,arguments)};case 2:return function(a,r){return n.apply(this,arguments)};case 3:return function(a,r,i){return n.apply(this,arguments)};case 4:return function(a,r,i,o){return n.apply(this,arguments)};case 5:return function(a,r,i,o,l){return n.apply(this,arguments)};case 6:return function(a,r,i,o,l,s){return n.apply(this,arguments)};case 7:return function(a,r,i,o,l,s,d){return n.apply(this,arguments)};case 8:return function(a,r,i,o,l,s,d,p){return n.apply(this,arguments)};case 9:return function(a,r,i,o,l,s,d,p,v){return n.apply(this,arguments)};case 10:return function(a,r,i,o,l,s,d,p,v,f){return n.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}var Ea=As;function Ms(e,n){return function(){return n.call(this,e.apply(this,arguments))}}var Es=Ms,La=Array.isArray||function(n){return n!=null&&n.length>=0&&Object.prototype.toString.call(n)==="[object Array]"};function Ls(e){return Object.prototype.toString.call(e)==="[object String]"}var Na=Ls,Ns=En,Vs=La,zs=Na,Bs=Ns(function(n){return Vs(n)?!0:!n||typeof n!="object"||zs(n)?!1:n.length===0?!0:n.length>0?n.hasOwnProperty(0)&&n.hasOwnProperty(n.length-1):!1}),Us=Bs,qs=Us,Ot=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function Hs(e,n,a){return function(i,o,l){if(qs(l))return e(i,o,l);if(l==null)return o;if(typeof l["fantasy-land/reduce"]=="function")return n(i,o,l,"fantasy-land/reduce");if(l[Ot]!=null)return a(i,o,l[Ot]());if(typeof l.next=="function")return a(i,o,l);if(typeof l.reduce=="function")return n(i,o,l,"reduce");throw new TypeError("reduce: list must be array or iterable")}}var Ws=Hs;function Gs(e,n,a){for(var r=0,i=a.length;r<i;){if(n=e["@@transducer/step"](n,a[r]),n&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}r+=1}return e["@@transducer/result"](n)}var Ys=Gs,Js=Ea,Ks=xr,Xs=Ks(function(n,a){return Js(n.length,function(){return n.apply(a,arguments)})}),Qs=Xs,Zs=Ws,ed=Ys,nd=Qs;function td(e,n,a){for(var r=a.next();!r.done;){if(n=e["@@transducer/step"](n,r.value),n&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}r=a.next()}return e["@@transducer/result"](n)}function ad(e,n,a,r){return e["@@transducer/result"](a[r](nd(e["@@transducer/step"],e),n))}var rd=Zs(ed,ad,td),id=rd,od=function(){function e(n){this.f=n}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(n){return n},e.prototype["@@transducer/step"]=function(n,a){return this.f(n,a)},e}();function ld(e){return new od(e)}var sd=ld,dd=hn,cd=id,ud=sd,hd=dd(function(e,n,a){return cd(typeof e=="function"?ud(e):e,n,a)}),pd=hd,fd=La;function vd(e,n){return function(){var a=arguments.length;if(a===0)return n();var r=arguments[a-1];return fd(r)||typeof r[e]!="function"?n.apply(this,arguments):r[e].apply(r,Array.prototype.slice.call(arguments,0,a-1))}}var Va=vd,md=Va,gd=hn,xd=gd(md("slice",function(n,a,r){return Array.prototype.slice.call(r,n,a)})),yd=xd,bd=Va,jd=En,Cd=yd,wd=jd(bd("tail",Cd(1,1/0))),Sd=wd,Td=Ea,Id=Es,_d=pd,$d=Sd;function Pd(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return Td(arguments[0].length,_d(Id,arguments[0],$d(arguments)))}var Rd=Pd,kd=En,Fd=Na,Od=kd(function(n){return Fd(n)?n.split("").reverse().join(""):Array.prototype.slice.call(n,0).reverse()}),Dd=Od,Ad=Rd,Md=Dd;function Ed(){if(arguments.length===0)throw new Error("compose requires at least one argument");return Ad.apply(this,Md(arguments))}var Ld=Ed;const Nd=Mn(Ld);var Vd=hn,zd=Vd(function(n,a,r){var i=Array.prototype.slice.call(r,0);return i.splice(n,a),i}),Bd=zd;const Dt=Mn(Bd),en="SelectInput",Se={rootSelect:`${en}-rootSelect`,icon:`${en}-icon`,menuPaper:`${en}-menuPaper`,inputSelect:`${en}-inputSelect`},Ud=$(Zr)(({theme:e})=>({width:"100%",padding:0,height:50,backgroundColor:"#fff",[`& .${ei.select}`]:{width:"100%",padding:e.spacing(1,1.5)},[`&.${Se.rootSelect}`]:{paddingRight:e.spacing(6),boxSizing:"border-box",backgroundColor:"#fff",color:e.palette.text.primary,display:"flex",alignItems:"center",justifyContent:"flex-start"},[`&.${Se.icon}`]:{right:e.spacing(1),color:"rgba(0,0,0,0.25)"},[`&.${Se.menuPaper}`]:{border:`2px solid ${e.palette.primary.light}`,borderTop:0,marginTop:-2,boxShadow:"none",backgroundColor:"#fff",maxHeight:"30vh",borderRadius:0,"& ul":{padding:"0"},"& li":{color:"currentColor",whiteSpace:"normal",backgroundColor:"transparent",paddingTop:e.spacing(1.5),paddingBottom:e.spacing(1.5),lineHeight:1.2,height:"auto"}},[`&.${Se.inputSelect}`]:{backgroundColor:"transparent",fontSize:"1rem","&:focus":{backgroundColor:"transparent"}}}));function za({children:e,value:n,name:a,onChange:r,...i}){return t.jsx(Ud,{variant:"standard",value:n,classes:{select:Se.rootSelect,icon:Se.icon},onChange:r,IconComponent:Jt,input:t.jsx(g,{}),inputProps:{name:a,classes:{select:Se.inputSelect}},MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"center"},classes:{paper:Se.menuPaper}},...i,children:e})}const qd=ta(c.flatFlags,e=>e.category),Ba=e=>{const n=Object.entries(qd).flatMap(([a,r])=>[t.jsx(rn,{disabled:!0,children:a},a),r.map(i=>t.jsx(rn,{value:i.value,style:{borderLeft:`1em solid ${i.bgColor||"transparent"}`,fontSize:"1rem"},children:i.text},i.value))]);return t.jsxs(za,{...e,children:[!!e.value&&t.jsx(rn,{value:"",children:"Remove Flag"}),n]})},Hd=e=>e.options?{...e,groupedOptions:[{title:"Section 1",children:e.options}],options:void 0}:e.groupedOptions?{...e,options:e.groupedOptions.flatMap(n=>n.children),groupedOptions:void 0}:e,At=e=>t.jsxs("div",{style:{width:"100%"},children:[t.jsxs(u,{children:[e.value.id?t.jsx("input",{type:"hidden",value:e.value.id,readOnly:!0}):null,t.jsx(Ne,{width:"200%",children:t.jsx(g,{required:!0,format:"bold",value:e.value.data.text||"",onChange:n=>{e.onChange({...e.value,data:{...e.value.data,text:n.target.value}})},placeholder:"Option"})}),t.jsx(Xe,{img:e.value.data.img,onChange:n=>{e.onChange({...e.value,data:{...e.value.data,img:n}})}}),t.jsx(Ba,{value:e.value.data.flag||"",onChange:n=>{e.onChange({...e.value,data:{...e.value.data,flag:n.target.value}})},sx:{width:{md:"160px"},maxWidth:"160px"}}),typeof e.index<"u"&&e.groups&&e.onMoveToGroup&&t.jsx(Ci,{items:e.groups.map((n,a)=>({label:`Move to ${n||`group ${a}`}`,onClick:()=>{e.onMoveToGroup&&typeof e.index=="number"&&e.onMoveToGroup(e.index,a)},disabled:a===e.groupIndex}))})]}),e.showValueField&&t.jsx(u,{children:t.jsx(g,{format:"data",value:e.value.data.val||"",placeholder:"Data Value",onChange:n=>{e.onChange({...e.value,data:{...e.value.data,val:n.target.value}})}})})]}),Wd=({formik:e})=>t.jsx(_,{subtitle:"Options",children:e.values.groupedOptions?t.jsxs(b,{children:[e.values.groupedOptions.map((n,a)=>t.jsxs(b,{mt:a===0?0:4,children:[t.jsxs(b,{display:"flex",pb:1,children:[t.jsx(u,{children:t.jsx(g,{required:!0,format:"bold",name:`groupedOptions[${a}].title`,value:n.title,placeholder:"Section Title",onChange:e.handleChange})}),t.jsx(b,{flex:0,children:t.jsx(Ke,{title:"Delete group","aria-label":"Delete group",onClick:()=>{e.setFieldValue("groupedOptions",Dt(a,1,e.values.groupedOptions))},size:"large",children:t.jsx(yr,{})})})]}),t.jsx(b,{pl:{md:2},children:t.jsx(Te,{values:n.children,onChange:r=>{e.setFieldValue(`groupedOptions[${a}].children`,r)},newValue:()=>({data:{text:"",description:"",val:"",flag:""}}),newValueLabel:"add new option",Editor:At,editorExtraProps:{groupIndex:a,showValueField:!!e.values.fn,onMoveToGroup:(r,i)=>{const o=n.children[r];e.setFieldValue("groupedOptions",Nd(Ft(i,l=>({...l,children:[...l.children,o]})),Ft(a,l=>({...l,children:Dt(r,1,l.children)})))(e.values.groupedOptions))},groups:e.values.groupedOptions.map(r=>r.title)}})})]},a)),t.jsx(b,{mt:1,children:t.jsx(fe,{size:"large",onClick:()=>{e.setFieldValue("groupedOptions",[...e.values.groupedOptions,{title:"",children:[]}])},children:"add new group"})})]}):t.jsx(Te,{values:e.values.options||[],onChange:n=>{e.setFieldValue("options",n)},newValueLabel:"add new option",newValue:()=>({data:{text:"",description:"",val:"",flag:""}}),Editor:At,editorExtraProps:{showValueField:!!e.values.fn}})}),Gd=e=>{var i,o,l,s,d,p,v,f,x,C,m;const n=c.ComponentType.Checklist,a=D({initialValues:{allRequired:((o=(i=e.node)==null?void 0:i.data)==null?void 0:o.allRequired)||!1,description:((s=(l=e.node)==null?void 0:l.data)==null?void 0:s.description)||"",fn:((p=(d=e.node)==null?void 0:d.data)==null?void 0:p.fn)||"",groupedOptions:e.groupedOptions,img:((f=(v=e.node)==null?void 0:v.data)==null?void 0:f.img)||"",options:e.options,text:((C=(x=e.node)==null?void 0:x.data)==null?void 0:C.text)||"",...ge((m=e.node)==null?void 0:m.data)},onSubmit:({options:h,groupedOptions:y,...w})=>{e.handleSubmit?e.handleSubmit({type:n,data:{...w,...y?{categories:y.map(j=>({title:j.title,count:j.children.length}))}:{categories:void 0}}},h?h.filter(j=>j.data.text).map(j=>({...j,id:j.id||void 0,type:c.ComponentType.Answer})):y?y.flatMap(j=>j.children).filter(j=>j.data.text).map(j=>({...j,id:j.id||void 0,type:c.ComponentType.Answer})):[]):alert(JSON.stringify({type:n,...w,options:h},null,2))},validate:()=>{}}),r=T.useRef(null);return T.useEffect(()=>{setTimeout(()=>{var h;document.activeElement.blur(),(h=r.current)==null||h.focus()},50)},[]),t.jsxs("form",{onSubmit:a.handleSubmit,id:"modal",children:[t.jsxs(k,{children:[t.jsx(_,{title:"Checklist",Icon:O[n],children:t.jsxs(me,{children:[t.jsxs(u,{children:[t.jsx(g,{format:"large",name:"text",value:a.values.text,placeholder:"Text",onChange:a.handleChange,inputRef:r,required:!0}),t.jsx(Xe,{img:a.values.img,onChange:h=>{a.setFieldValue("img",h)}})]}),t.jsx(u,{children:t.jsx(R,{name:"description",value:a.values.description,placeholder:"Description",onChange:a.handleChange})}),t.jsx(u,{children:t.jsx(g,{format:"data",name:"fn",value:a.values.fn,placeholder:"Data Field",onChange:a.handleChange})}),t.jsx(ae,{selected:!!a.values.groupedOptions,onClick:()=>{a.setValues({...a.values,...Hd({options:a.values.options,groupedOptions:a.values.groupedOptions})})},children:"Expandable"}),t.jsx(ae,{selected:a.values.allRequired,onClick:()=>{a.setFieldValue("allRequired",!a.values.allRequired)},children:"All required"})]})}),t.jsx(Wd,{formik:a})]}),t.jsx(H,{changeField:a.handleChange,definitionImg:a.values.definitionImg,howMeasured:a.values.howMeasured,policyRef:a.values.policyRef,info:a.values.info}),t.jsx(V,{name:"notes",onChange:a.handleChange,value:a.values.notes})]})},Yd=e=>({nextSteps:(e==null?void 0:e.nextSteps)||[]});function Jd(e){return t.jsxs(b,{width:"100%",children:[t.jsx(u,{children:t.jsx(g,{required:!0,name:"title",value:e.value.title,onChange:n=>{e.onChange({...e.value,title:n.target.value})},placeholder:"Title"})}),t.jsx(u,{children:t.jsx(g,{required:!0,name:"description",value:e.value.description,onChange:n=>{e.onChange({...e.value,description:n.target.value})},placeholder:"Description"})})]})}function Kd(e){var r,i,o,l,s,d,p,v,f;const n=c.ComponentType.Confirmation,a=D({initialValues:{heading:((i=(r=e.node)==null?void 0:r.data)==null?void 0:i.heading)||"Application sent",description:((l=(o=e.node)==null?void 0:o.data)==null?void 0:l.description)||"A payment receipt has been emailed to you. You will also receive an email to confirm when your application has been received.",moreInfo:((d=(s=e.node)==null?void 0:s.data)==null?void 0:d.moreInfo)||`<h2>You will be contacted</h2>
        <ul>
        <li>if there is anything missing from the information you have provided so far</li>
        <li>if any additional information is required</li>
        <li>to arrange a site visit, if required</li>
        <li>to inform you whether a certificate has been granted or not</li>
        </ul>`,contactInfo:((v=(p=e.node)==null?void 0:p.data)==null?void 0:v.contactInfo)||`You can contact us at <em>planning@lambeth.gov.uk</em>
          <br/><br/>
          What did you think of this service? Please give us your feedback using the link in the footer below.`,...Yd((f=e.node)==null?void 0:f.data)},onSubmit:x=>{e.handleSubmit&&e.handleSubmit({type:n,data:x})}});return t.jsxs("form",{onSubmit:a.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Top Banner",children:[t.jsx(u,{children:t.jsx(g,{placeholder:"Heading",name:"heading",value:a.values.heading,onChange:a.handleChange})}),t.jsx(u,{children:t.jsx(g,{placeholder:"Description",name:"description",value:a.values.description,onChange:a.handleChange})})]})}),t.jsx(k,{children:t.jsx(_,{title:"Next Steps",Icon:O[c.ComponentType.TaskList],children:t.jsx(Te,{values:a.values.nextSteps,onChange:x=>{a.setFieldValue("nextSteps",x)},Editor:Jd,newValue:()=>({title:"",description:""})})})}),t.jsx(k,{children:t.jsx(_,{title:"More Information",Icon:O[c.ComponentType.Confirmation],children:t.jsx(R,{value:a.values.moreInfo,name:"moreInfo",onChange:a.handleChange})})}),t.jsx(k,{children:t.jsx(_,{title:"Contact Us",Icon:O[c.ComponentType.Send],children:t.jsx(R,{value:a.values.contactInfo,name:"contactInfo",onChange:a.handleChange})})})]})}function Xd(e){var a;const n=D({initialValues:ni((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.ContactInput,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Contact Input",Icon:O[c.ComponentType.ContactInput],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",value:n.values.title,placeholder:"Title",onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Description",name:"description",value:n.values.description,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(g,{required:!0,format:"data",name:"fn",value:n.values.fn,placeholder:"Data Field",onChange:n.handleChange})})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const Qd=e=>({content:(e==null?void 0:e.content)||"",color:e==null?void 0:e.color,...ge(e)}),Zd=e=>{var a;const n=D({initialValues:Qd((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.Content,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Content",Icon:O[c.ComponentType.Content],children:[t.jsx(u,{children:t.jsx(R,{placeholder:"Content",name:"content",value:n.values.content,onChange:n.handleChange})}),t.jsx(Yt,{inline:!0,color:n.values.color,onChange:r=>{n.setFieldValue("color",r)}})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})},ec=e=>{var a;const n=D({initialValues:ti((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.DateInput,data:r})},validateOnChange:!1,validationSchema:ai()});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",name:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Date Input",Icon:O[c.ComponentType.DateInput],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",value:n.values.title,placeholder:"Title",onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Description",name:"description",value:n.values.description,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(g,{format:"data",name:"fn",value:n.values.fn,placeholder:"Data Field",onChange:n.handleChange})}),t.jsx(b,{mt:2,children:t.jsx(u,{children:t.jsx(gt,{label:"min",value:n.values.min,error:n.errors.min,onChange:(r,i)=>{n.setFieldValue("min",xt(r,i))}})})}),t.jsx(b,{mt:2,children:t.jsx(u,{children:t.jsx(gt,{label:"max",value:n.values.max,error:n.errors.max,onChange:(r,i)=>{n.setFieldValue("max",xt(r,i))}})})})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})};function nc(e){var a,r,i,o,l,s,d;const n=D({initialValues:Mr((a=e.node)==null?void 0:a.data),onSubmit:p=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.DrawBoundary,data:p})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsxs(k,{children:[t.jsxs(_,{title:"Draw boundary",Icon:O[c.ComponentType.DrawBoundary],children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:(i=(r=e.node)==null?void 0:r.data)==null?void 0:i.title,name:"title",value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{name:"description",placeholder:"Description",value:n.values.description,onChange:n.handleChange})}),t.jsx(me,{label:"Boundary data field",children:t.jsx(u,{children:t.jsx(g,{name:"dataFieldBoundary",placeholder:"",format:"data",value:n.values.dataFieldBoundary,onChange:n.handleChange})})}),t.jsx(me,{label:"Area data field (square metres)",children:t.jsx(u,{children:t.jsx(g,{name:"dataFieldArea",placeholder:"property.boundary.area",format:"data",value:n.values.dataFieldArea,onChange:n.handleChange})})})]}),t.jsxs(_,{title:(l=(o=e.node)==null?void 0:o.data)==null?void 0:l.titleForUploading,Icon:O[c.ComponentType.DrawBoundary],children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:(d=(s=e.node)==null?void 0:s.data)==null?void 0:d.titleForUploading,name:"titleForUploading",value:n.values.titleForUploading,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{name:"descriptionForUploading",placeholder:"Description",value:n.values.descriptionForUploading,onChange:n.handleChange})}),t.jsx(ae,{selected:n.values.hideFileUpload,onClick:()=>{n.setFieldValue("hideFileUpload",!n.values.hideFileUpload)},children:"Hide file upload and allow user to continue without data"})]})]}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const tc=({id:e,handleSubmit:n,flowId:a="",flows:r=[]})=>{const i=D({initialValues:{flowId:a},onSubmit:o=>{n?n({type:c.ComponentType.ExternalPortal,data:o}):alert(JSON.stringify(o,null,2))}});return t.jsx("form",{id:"modal",onSubmit:i.handleSubmit,"data-testid":"form",children:t.jsxs(k,{children:[t.jsx(_,{title:"External portal",Icon:O[c.ComponentType.ExternalPortal],children:t.jsx("span",{children:"External portals let you reference all content from another flow inline within this service. Deleting this node does NOT delete the flow that it references."})}),t.jsx(_,{title:"Pick a flow",children:t.jsxs("select",{"data-testid":"flowId",name:"flowId",value:i.values.flowId,onChange:i.handleChange,children:[!e&&t.jsx("option",{value:""}),r.map(o=>t.jsx("option",{value:o.id,children:o.text},o.id))]})})]})})};function ac(e){var a,r,i,o,l,s,d,p,v,f,x,C,m,h,y,w,j,E;const n=D({initialValues:{color:((r=(a=e.node)==null?void 0:a.data)==null?void 0:r.color)||"#EFEFEF",definitionImg:(o=(i=e.node)==null?void 0:i.data)==null?void 0:o.definitionImg,description:((s=(l=e.node)==null?void 0:l.data)==null?void 0:s.description)||"",fn:((p=(d=e.node)==null?void 0:d.data)==null?void 0:p.fn)||"",howMeasured:(f=(v=e.node)==null?void 0:v.data)==null?void 0:f.howMeasured,info:(C=(x=e.node)==null?void 0:x.data)==null?void 0:C.info,notes:((h=(m=e.node)==null?void 0:m.data)==null?void 0:h.notes)||"",policyRef:(w=(y=e.node)==null?void 0:y.data)==null?void 0:w.policyRef,title:((E=(j=e.node)==null?void 0:j.data)==null?void 0:E.title)||""},onSubmit:W=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.FileUpload,data:W})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"File upload",Icon:O[c.ComponentType.FileUpload],children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:"File Upload",name:"title",value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Description",name:"description",value:n.values.description,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(g,{required:!0,format:"data",name:"fn",value:n.values.fn,placeholder:"Data Field",onChange:n.handleChange})})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",onChange:n.handleChange,value:n.values.notes})]})}const rc=$(b)(()=>({display:"flex",alignItems:"center"})),ic=$(I)(({theme:e})=>({padding:e.spacing(1.15,0,.75)})),jn=({title:e})=>t.jsx(rc,{sx:{display:"flex"},children:t.jsx(ic,{variant:"subtitle2",children:e})}),Ua=$(I)(({theme:e})=>({alignSelf:"center",padding:e.spacing(0,2)}));Ua.defaultProps={variant:"body2"};function oc(e){var a;const n=D({initialValues:Er((a=e.node)==null?void 0:a.data),validationSchema:ri,validateOnBlur:!0,validateOnChange:!1,onSubmit:r=>{var i;(i=e.handleSubmit)==null||i.call(e,{type:c.ComponentType.FileUploadAndLabel,data:r})}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Upload and label",Icon:O[c.ComponentType.FileUploadAndLabel],children:[t.jsx(u,{children:t.jsx(g,{required:!0,format:"large",name:"title",placeholder:n.values.title,value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{multiline:!0,name:"description",placeholder:"Description",value:n.values.description,onChange:n.handleChange})}),t.jsx(ae,{selected:n.values.hideDropZone,onClick:()=>{n.setFieldValue("hideDropZone",!n.values.hideDropZone)},children:"Hide the drop zone and show files list for information only"})]})}),t.jsx(k,{children:t.jsx(_,{title:"File types",Icon:ii,children:t.jsx(Te,{values:n.values.fileTypes,onChange:r=>{n.setFieldValue("fileTypes",r)},Editor:lc,newValue:Lr})})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}function lc(e){var a,r,i,o;const n=ea(e.value.rule.condition);return t.jsxs(b,{sx:{flex:1},"data-testid":"rule-list-manager",children:[t.jsx(jn,{title:"File"}),t.jsx(u,{children:t.jsx(g,{required:!0,name:"name",value:e.value.name,onChange:l=>e.onChange(le.merge(e.value,{name:l.target.value})),placeholder:"File type"})}),t.jsx(u,{children:t.jsx(g,{required:!0,name:"fn",format:"data",value:e.value.fn,onChange:l=>e.onChange(le.merge(e.value,{fn:l.target.value})),placeholder:"Data field"})}),t.jsx(jn,{title:"Rule"}),t.jsx(u,{children:t.jsx(za,{value:e.value.rule.condition,onChange:l=>e.onChange(sc(ft[l.target.value],e.value)),children:Object.entries(ft).map(([l,s])=>t.jsx(rn,{value:s,children:le.upperFirst(le.lowerCase(s))},l))})}),n&&t.jsxs(u,{children:[t.jsx(g,{required:!0,name:"fn",value:e.value.rule.fn,onChange:l=>e.onChange(le.merge(e.value,{rule:{fn:l.target.value}})),placeholder:"Data field"}),t.jsx(Ua,{children:"Equals"}),t.jsx(g,{required:!0,name:"val",value:e.value.rule.val,onChange:l=>e.onChange(le.merge(e.value,{rule:{val:l.target.value}})),placeholder:"Value"})]}),t.jsx(jn,{title:"Additional file information"}),t.jsx(u,{children:t.jsx(R,{multiline:!0,name:"info",value:(a=e.value.moreInformation)==null?void 0:a.info,onChange:l=>{e.onChange(le.merge(e.value,{moreInformation:{info:l.target.value}}))},placeholder:"Why it matters"})}),t.jsx(u,{children:t.jsx(R,{multiline:!0,name:"policyRef",value:(r=e.value.moreInformation)==null?void 0:r.policyRef,onChange:l=>{e.onChange(le.merge(e.value,{moreInformation:{policyRef:l.target.value}}))},placeholder:"Policy source"})}),t.jsxs(u,{children:[t.jsx(R,{multiline:!0,name:"howMeasured",value:(i=e.value.moreInformation)==null?void 0:i.howMeasured,onChange:l=>{e.onChange(le.merge(e.value,{moreInformation:{howMeasured:l.target.value}}))},placeholder:"How is it defined?"}),t.jsx(Ne,{width:50,children:t.jsx(Xe,{img:(o=e.value.moreInformation)==null?void 0:o.definitionImg,onChange:l=>{e.onChange(le.merge(e.value,{moreInformation:{definitionImg:l??""}}))}})})]}),t.jsx(sn,{sx:{mb:2,mt:4}})]})}const sc=(e,n)=>{const a=ea(e),r={condition:e,operator:a?Nr.Equals:void 0,fn:a?n.rule.fn:void 0,val:a?n.rule.val:void 0};return{...n,rule:r}},dc=e=>{const n=D({initialValues:{},onSubmit:a=>{if(e.handleSubmit){const r=e.id?void 0:[...c.flatFlags,{category:c.DEFAULT_FLAG_CATEGORY,text:"(No Result)",value:""}].filter(i=>i.category===c.DEFAULT_FLAG_CATEGORY).map(i=>({type:c.ComponentType.Answer,data:{text:i.text,val:i.value}}));e.handleSubmit({type:c.ComponentType.Filter,data:{newValues:a,fn:"flag"}},r)}},validate:()=>{}});return t.jsx("form",{onSubmit:n.handleSubmit,id:"modal",children:t.jsx("h1",{children:"Filter Component"})})};function cc(e){var a;const n=D({initialValues:oi((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.FindProperty,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsxs(k,{children:[t.jsxs(_,{title:"Find Property",Icon:O[c.ComponentType.FindProperty],children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:"Title",name:"title",value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{name:"description",placeholder:"Description",value:n.values.description,onChange:n.handleChange})})]}),t.jsxs(_,{children:[t.jsx(u,{children:t.jsx(ae,{selected:n.values.allowNewAddresses,onClick:()=>{n.setFieldValue("allowNewAddresses",!n.values.allowNewAddresses)},children:"Allow users to plot new addresses without a UPRN"})}),n.values.allowNewAddresses?t.jsxs(t.Fragment,{children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:"Title",name:"newAddressTitle",value:n.values.newAddressTitle,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{name:"newAddressDescription",placeholder:"Description",value:n.values.newAddressDescription,onChange:n.handleChange})}),t.jsx(me,{label:"New address description label",children:t.jsx(u,{children:t.jsx(Ne,{width:"100%",children:t.jsx(g,{id:"new-address-description-label",placeholder:"Label",name:"newAddressDescriptionLabel",value:n.values.newAddressDescriptionLabel,onChange:n.handleChange})})})})]}):t.jsx(t.Fragment,{})]})]}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const Cn="InputField",Be={root:`${Cn}-root`,input:`${Cn}-input`,multiline:`${Cn}-multiline`},uc=$(br)(({theme:e})=>({[`&.${Be.root}`]:{backgroundColor:e.palette.common.white,border:`1px solid ${e.palette.border.light}`,transition:"background-color 0.2s ease-out",display:"block",width:"100%",padding:0,[`& + .${Be.root}`]:{marginTop:e.spacing(1)}},[`& .${Be.input}`]:{padding:e.spacing(1)},[`&.${Be.multiline}`]:{padding:e.spacing(1),[`&.${Be.root}`]:{padding:0}}}));function hc(e){return t.jsx(uc,{classes:Be,...e})}const pc=({id:e,handleSubmit:n,text:a="",flowId:r="",flows:i=[]})=>{const o=D({initialValues:{text:a,flowId:r},validate:l=>{const s={};return!l.flowId&&!l.text&&(s.text=i.length>0?"Required if no flow is selected":"Required."),s},onSubmit:l=>{const s=l.flowId?l.flowId:{type:c.ComponentType.InternalPortal,data:l};n?n(s):alert(JSON.stringify(s,null,2))}});return t.jsxs("form",{id:"modal",onSubmit:o.handleSubmit,"data-testid":"form",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"portalFlowId",children:"Create new internal portal: "}),t.jsx(hc,{name:"text",onChange:o.handleChange,placeholder:"Portal name",rows:2,value:o.values.text,disabled:!!o.values.flowId,id:"portalFlowId"}),o.errors.text&&t.jsx(jr,{message:o.errors.text})]}),(i==null?void 0:i.length)>0&&t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:[t.jsx("br",{})," OR",t.jsx("br",{}),t.jsx("br",{}),t.jsx("label",{htmlFor:"flowId",children:"Point to an existing portal:"}),t.jsx("br",{})]}),t.jsxs("select",{id:"flowId","data-testid":"flowId",name:"flowId",value:o.values.flowId,onChange:o.handleChange,disabled:!!o.values.text,children:[!e&&t.jsx("option",{value:""}),i.map(l=>t.jsx("option",{value:l.id,children:l.text},l.id))]})]})]})},fc=e=>({steps:(e==null?void 0:e.steps)||[],title:(e==null?void 0:e.title)||vc,description:(e==null?void 0:e.description)||"",...ge(e)}),vc="What would you like to do next?",mc=()=>({title:"",description:"",url:""}),gc=e=>t.jsxs(b,{sx:{flex:1},children:[t.jsx(u,{children:t.jsx(g,{required:!0,name:"title",value:e.value.title,onChange:n=>{e.onChange({...e.value,title:n.target.value})},placeholder:"Title"})}),t.jsx(u,{children:t.jsx(g,{name:"description",value:e.value.description,onChange:n=>{e.onChange({...e.value,description:n.target.value})},placeholder:"Description"})}),t.jsx(u,{children:t.jsx(g,{name:"url",type:"url",value:e.value.url,onChange:n=>{e.onChange({...e.value,url:n.target.value})},placeholder:"url"})})]}),xc=e=>{var a;const n=D({initialValues:fc((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.NextSteps,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Next Steps",Icon:O[c.ComponentType.NextSteps],children:[t.jsxs(b,{mb:"1rem",children:[t.jsx(u,{children:t.jsx(g,{name:"title",value:n.values.title,onChange:n.handleChange,placeholder:"Main Title",format:"large"})}),t.jsx(u,{children:t.jsx(R,{name:"description",value:n.values.description,onChange:n.handleChange,placeholder:"Main Description"})})]}),t.jsx(Te,{values:n.values.steps,onChange:r=>{n.setFieldValue("steps",r)},Editor:gc,newValue:mc})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",onChange:n.handleChange,value:n.values.notes})]})},yc=e=>({title:(e==null?void 0:e.title)||"",description:(e==null?void 0:e.description)||"",color:(e==null?void 0:e.color)||"#EFEFEF",resetButton:(e==null?void 0:e.resetButton)||!1,...ge(e)}),bc=e=>t.jsxs(t.Fragment,{children:[t.jsx(k,{children:t.jsxs(_,{title:"Notice",Icon:O[c.ComponentType.Notice],children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:"Notice",value:e.value.title,onChange:n=>{e.onChange({...e.value,title:n.target.value})}})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Description",value:e.value.description,onChange:n=>{e.onChange({...e.value,description:n.target.value})}})}),t.jsx(Yt,{inline:!0,color:e.value.color,onChange:n=>{e.onChange({...e.value,color:n})}}),t.jsx(ae,{selected:!!e.value.resetButton,onClick:()=>{e.onChange({...e.value,resetButton:!e.value.resetButton})},children:"Reset"})]})}),t.jsx(H,{changeField:n=>{e.onChange({...e.value,[n.target.name]:n.target.value})},definitionImg:e.value.definitionImg,howMeasured:e.value.howMeasured,policyRef:e.value.policyRef,info:e.value.info}),t.jsx(V,{name:"notes",onChange:n=>{e.onChange({...e.value,notes:n.target.value})},value:e.value.notes})]}),jc=e=>{var a;const n=D({initialValues:{notice:yc((a=e.node)==null?void 0:a.data)},onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.Notice,data:r.notice})},validate:()=>{}});return t.jsx("form",{onSubmit:n.handleSubmit,id:"modal",children:t.jsx(bc,{value:n.values.notice,onChange:r=>{n.setFieldValue("notice",r)}})})};function Cc(e){var a;const n=D({initialValues:li((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.NumberInput,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Number input",Icon:O[c.ComponentType.NumberInput],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",value:n.values.title,placeholder:"Title",onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Description",name:"description",value:n.values.description,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(g,{format:"data",name:"fn",value:n.values.fn,placeholder:"Data Field",onChange:n.handleChange})}),t.jsxs(u,{children:[t.jsx(wi,{children:"units"}),t.jsx(Ne,{children:t.jsx(g,{name:"units",value:n.values.units,placeholder:"e.g. square meters",onChange:n.handleChange})})]}),t.jsx(u,{children:t.jsx(ae,{selected:n.values.allowNegatives,onClick:()=>{n.setFieldValue("allowNegatives",!n.values.allowNegatives)},children:"Allow negative numbers to be input"})})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}var rt={},wc=Q;Object.defineProperty(rt,"__esModule",{value:!0});var qa=rt.default=void 0,Sc=wc(X()),Tc=t,Ic=(0,Sc.default)((0,Tc.jsx)("path",{d:"M4 7v2c0 .55-.45 1-1 1H2v4h1c.55 0 1 .45 1 1v2c0 1.65 1.35 3 3 3h3v-2H7c-.55 0-1-.45-1-1v-2c0-1.3-.84-2.42-2-2.83v-.34C5.16 11.42 6 10.3 6 9V7c0-.55.45-1 1-1h3V4H7C5.35 4 4 5.35 4 7zm17 3c-.55 0-1-.45-1-1V7c0-1.65-1.35-3-3-3h-3v2h3c.55 0 1 .45 1 1v2c0 1.3.84 2.42 2 2.83v.34c-1.16.41-2 1.52-2 2.83v2c0 .55-.45 1-1 1h-3v2h3c1.65 0 3-1.35 3-3v-2c0-.55.45-1 1-1h1v-4h-1z"}),"DataObject");qa=rt.default=Ic;const _c="https://docs.payments.service.gov.uk/reporting/#add-more-information-to-a-payment-39-custom-metadata-39-or-39-reporting-columns-39",$c=(e,n)=>{if(e&&typeof e!="string"&&e[n])return e[n].key||e[n].value},Pc=(e,n)=>{if(e&&typeof e!="string"&&e[n])return e[n].key&&e[n].value},Ha=(e,n)=>yt.includes(e)&&n===yt.indexOf(e);function Rc(e){const{key:n,value:a}=e.value,r=Ha(n,e.index),{errors:i,touched:o}=Br(),l=$c(i.govPayMetadata,e.index),s=Pc(o.govPayMetadata,e.index);return t.jsx(b,{sx:{flex:1},"data-testid":"rule-list-manager",children:t.jsx(Ln,{error:s?l:void 0,children:t.jsxs(u,{children:[t.jsx(g,{"aria-labelledby":"key-label",disabled:r,value:n,onChange:({target:{value:d}})=>e.onChange({key:d,value:a}),placeholder:"key"}),t.jsx(g,{format:a.toString().startsWith("@")?"data":void 0,"aria-labelledby":"value-label",disabled:r,value:a,onChange:({target:{value:d}})=>e.onChange({key:n,value:d}),placeholder:"value"})]})})})}const kc=e=>{var i,o,l,s,d,p,v,f,x,C,m,h,y,w,j,E,W,U,q,J,G,Z,Y,ee,S,A,F,xe,Pe,Re,ke;const[n]=N(P=>[P.flowName]),a={title:((o=(i=e.node)==null?void 0:i.data)==null?void 0:o.title)||"Pay for your application",bannerTitle:((s=(l=e.node)==null?void 0:l.data)==null?void 0:s.bannerTitle)||"The planning fee for this application is",description:((p=(d=e.node)==null?void 0:d.data)==null?void 0:p.description)||'<p>The planning fee covers the cost of processing your application.         <a href="https://www.gov.uk/guidance/fees-for-planning-applications" target="_self">Find out more about how planning fees are calculated</a> (opens in new tab).</p>',fn:(f=(v=e.node)==null?void 0:v.data)==null?void 0:f.fn,instructionsTitle:((C=(x=e.node)==null?void 0:x.data)==null?void 0:C.instructionsTitle)||"How to pay",instructionsDescription:((h=(m=e.node)==null?void 0:m.data)==null?void 0:h.instructionsDescription)||"<p>You can pay for your application by using GOV.UK Pay.</p>         <p>Your application will be sent after you have paid the fee.          Wait until you see an application sent message before closing your browser.</p>",hidePay:((w=(y=e.node)==null?void 0:y.data)==null?void 0:w.hidePay)||!1,allowInviteToPay:((E=(j=e.node)==null?void 0:j.data)==null?void 0:E.allowInviteToPay)??!0,secondaryPageTitle:((U=(W=e.node)==null?void 0:W.data)==null?void 0:U.secondaryPageTitle)||"Invite someone else to pay for this application",nomineeTitle:((J=(q=e.node)==null?void 0:q.data)==null?void 0:J.nomineeTitle)||"Details of the person paying",nomineeDescription:(Z=(G=e.node)==null?void 0:G.data)==null?void 0:Z.nomineeDescription,yourDetailsTitle:((ee=(Y=e.node)==null?void 0:Y.data)==null?void 0:ee.yourDetailsTitle)||"Your details",yourDetailsDescription:(A=(S=e.node)==null?void 0:S.data)==null?void 0:A.yourDetailsDescription,yourDetailsLabel:((xe=(F=e.node)==null?void 0:F.data)==null?void 0:xe.yourDetailsLabel)||"Your name or organisation name",govPayMetadata:((Re=(Pe=e.node)==null?void 0:Pe.data)==null?void 0:Re.govPayMetadata)||[{key:"flow",value:n},{key:"source",value:"PlanX"},{key:"paidViaInviteToPay",value:"@paidViaInviteToPay"}],...ge((ke=e.node)==null?void 0:ke.data)},r=P=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.Pay,data:P})};return t.jsx(Vr,{initialValues:a,onSubmit:r,validationSchema:si,validateOnChange:!0,validateOnBlur:!0,children:({values:P,handleChange:z,setFieldValue:oe,errors:ye,touched:Fe,setTouched:Oe})=>t.jsxs(zr,{id:"modal",name:"modal",children:[t.jsxs(k,{children:[t.jsxs(_,{title:"Payment",Icon:O[c.ComponentType.Pay],children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:"Page title",name:"title",value:P.title,onChange:z})}),t.jsx(u,{children:t.jsx(g,{format:"bold",placeholder:"Banner title",name:"bannerTitle",value:P.bannerTitle,onChange:z})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Banner description",name:"description",value:P.description,onChange:z})}),t.jsx(u,{children:t.jsx(g,{format:"data",name:"fn",value:P.fn,placeholder:"Data field for calculated amount",onChange:z})})]}),t.jsxs(_,{children:[t.jsx(u,{children:t.jsx(g,{format:"large",placeholder:"Instructions title",name:"instructionsTitle",value:P.instructionsTitle,onChange:z})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Instructions description",name:"instructionsDescription",value:P.instructionsDescription,onChange:z})})]}),t.jsx(ae,{selected:P.hidePay,onClick:()=>{oe("hidePay",!P.hidePay)},style:{width:"100%"},children:"Hide the pay buttons and show fee for information only"})]}),t.jsx(k,{children:t.jsxs(_,{title:"GOV.UK Pay Metadata",Icon:qa,children:[t.jsxs(I,{variant:"subtitle2",sx:{mb:2},children:["Include metadata alongside payments, such as VAT codes, cost centers, or ledger codes. See"," ",t.jsx(de,{href:_c,target:"_blank",rel:"noopener noreferrer",children:"GOV.UK Pay documentation"})," ","for more details."]}),t.jsx(I,{variant:"subtitle2",sx:{mb:2},children:"Any values beginning with @ will be dynamically read from data values set throughout the flow."}),t.jsx(Ln,{error:typeof ye.govPayMetadata=="string"&&Fe.govPayMetadata?ye.govPayMetadata:void 0,children:t.jsxs(t.Fragment,{children:[t.jsxs(b,{sx:{width:"100%",mb:1,display:"flex",justifyContent:"space-evenly"},children:[t.jsx(I,{sx:{width:"100%",ml:5},variant:"subtitle2",component:"label",id:"key-label",children:"Key"}),t.jsx(I,{sx:{width:"100%",ml:-5},variant:"subtitle2",component:"label",id:"value-label",children:"Value"})]}),t.jsx(Te,{maxItems:10,disableDragAndDrop:!0,values:P.govPayMetadata||[],onChange:ne=>{oe("govPayMetadata",ne)},Editor:Rc,newValue:()=>(Oe({}),{key:"",value:""}),isFieldDisabled:({key:ne},De)=>Ha(ne,De)})]})})]})}),t.jsx(k,{children:t.jsxs(_,{title:"Invite to Pay",Icon:O[c.ComponentType.Pay],children:[t.jsx(ae,{selected:P.allowInviteToPay,onClick:()=>{oe("allowInviteToPay",!P.allowInviteToPay)},style:{width:"100%"},children:"Allow applicants to invite someone else to pay"}),P.allowInviteToPay?t.jsxs(t.Fragment,{children:[t.jsx(b,{children:t.jsx(u,{children:t.jsx(g,{required:!0,format:"large",name:"secondaryPageTitle",placeholder:"Card title",value:P.secondaryPageTitle,onChange:z})})}),t.jsxs(b,{pt:4,children:[t.jsx(u,{children:t.jsx(g,{required:!0,format:"large",name:"nomineeTitle",placeholder:"Title",value:P.nomineeTitle,onChange:z})}),t.jsx(u,{children:t.jsx(R,{name:"nomineeDescription",placeholder:"Description",value:P.nomineeDescription,onChange:z})})]}),t.jsxs(b,{pt:4,children:[t.jsx(u,{children:t.jsx(g,{required:!0,format:"large",name:"yourDetailsTitle",placeholder:"Title",value:P.yourDetailsTitle,onChange:z})}),t.jsx(u,{children:t.jsx(R,{name:"yourDetailsDescription",placeholder:"Description",value:P.yourDetailsDescription,onChange:z})}),t.jsx(u,{children:t.jsx(g,{required:!0,name:"yourDetailsLabel",placeholder:"Label",value:P.yourDetailsLabel,onChange:z})})]})]}):t.jsx(t.Fragment,{})]})}),t.jsx(H,{changeField:z,definitionImg:P.definitionImg,howMeasured:P.howMeasured,policyRef:P.policyRef,info:P.info}),t.jsx(V,{name:"notes",onChange:z,value:P.notes})]})})};function Fc(e){var a;const n=D({initialValues:di((a=e.node)==null?void 0:a.data),onSubmit:r=>{var i;(i=e.handleSubmit)==null||i.call(e,{type:c.ComponentType.PlanningConstraints,data:r})}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Planning constraints",Icon:O[c.ComponentType.PlanningConstraints],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",placeholder:n.values.title,value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{name:"description",placeholder:"Description",value:n.values.description,onChange:n.handleChange})}),t.jsx(me,{label:"Planning constraints data field",children:t.jsx(u,{children:t.jsx(g,{format:"data",name:"fn",placeholder:n.values.fn,value:n.values.fn,onChange:n.handleChange})})}),t.jsx(me,{label:"Planning conditions disclaimer",children:t.jsx(u,{children:t.jsx(R,{name:"disclaimer",placeholder:"Planning conditions disclaimer",value:n.values.disclaimer,onChange:n.handleChange})})})]})}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const Oc=e=>({title:(e==null?void 0:e.title)||"About the property",description:(e==null?void 0:e.description)||"This is the information we currently have about the property, including its title boundary shown in blue from the Land Registry",showPropertyTypeOverride:(e==null?void 0:e.showPropertyTypeOverride)||!1,...ge(e)});function Dc(e){var a;const n=D({initialValues:Oc((a=e.node)==null?void 0:a.data),onSubmit:r=>{var i;(i=e.handleSubmit)==null||i.call(e,{type:c.ComponentType.PropertyInformation,data:r})}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Property information",Icon:O[c.ComponentType.PropertyInformation],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",placeholder:n.values.title,value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{name:"description",placeholder:"Description",value:n.values.description,onChange:n.handleChange})}),t.jsx(ae,{selected:n.values.showPropertyTypeOverride,onClick:()=>{n.setFieldValue("showPropertyTypeOverride",!n.values.showPropertyTypeOverride)},children:'Show users a "change" link to override the property type'})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const Ac=e=>t.jsxs("div",{style:{width:"100%"},children:[t.jsxs(u,{children:[e.value.id&&t.jsx("input",{type:"hidden",value:e.value.id,readOnly:!0}),t.jsx(Ne,{width:"200%",children:t.jsx(g,{required:!0,format:"bold",value:e.value.data.text||"",onChange:n=>{e.onChange({...e.value,data:{...e.value.data,text:n.target.value}})},placeholder:"Option"})}),t.jsx(Xe,{img:e.value.data.img,onChange:n=>{e.onChange({...e.value,data:{...e.value.data,img:n}})}}),t.jsx(Ba,{value:e.value.data.flag||"",onChange:n=>{e.onChange({...e.value,data:{...e.value.data,flag:n.target.value}})},sx:{width:{md:"160px"},maxWidth:"160px"}})]}),t.jsx(u,{children:t.jsx(g,{value:e.value.data.description||"",placeholder:"Description",onChange:n=>{e.onChange({...e.value,data:{...e.value.data,description:n.target.value}})}})}),e.showValueField&&t.jsx(u,{children:t.jsx(g,{format:"data",value:e.value.data.val||"",placeholder:"Data Value",onChange:n=>{e.onChange({...e.value,data:{...e.value.data,val:n.target.value}})}})})]}),Mc=e=>{var i,o,l,s,d,p,v,f,x;const n=c.ComponentType.Question,a=D({initialValues:{description:((o=(i=e.node)==null?void 0:i.data)==null?void 0:o.description)||"",fn:((s=(l=e.node)==null?void 0:l.data)==null?void 0:s.fn)||"",img:((p=(d=e.node)==null?void 0:d.data)==null?void 0:p.img)||"",options:e.options||[],text:((f=(v=e.node)==null?void 0:v.data)==null?void 0:f.text)||"",...ge((x=e.node)==null?void 0:x.data)},onSubmit:({options:C,...m})=>{const h=C.filter(y=>y.data.text).map(y=>({id:y.id||void 0,type:c.ComponentType.Answer,data:y.data}));e.handleSubmit?e.handleSubmit({type:n,data:m},h):alert(JSON.stringify({type:n,...m,children:h},null,2))},validate:()=>{}}),r=T.useRef(null);return T.useEffect(()=>{setTimeout(()=>{var C;document.activeElement.blur(),(C=r.current)==null||C.focus()},50)},[]),t.jsxs("form",{onSubmit:a.handleSubmit,id:"modal",children:[t.jsxs(k,{children:[t.jsx(_,{title:"Question",Icon:O[n],children:t.jsxs(me,{children:[t.jsxs(u,{children:[t.jsx(g,{format:"large",name:"text",value:a.values.text,placeholder:"Text",onChange:a.handleChange,inputRef:r}),t.jsx(Xe,{img:a.values.img,onChange:C=>{a.setFieldValue("img",C)}})]}),t.jsx(u,{children:t.jsx(R,{name:"description",value:a.values.description,placeholder:"Description",onChange:a.handleChange})}),t.jsx(u,{children:t.jsx(g,{format:"data",name:"fn",value:a.values.fn,placeholder:"Data Field",onChange:a.handleChange})})]})}),t.jsx(_,{subtitle:"Options",children:t.jsx(Te,{values:a.values.options,onChange:C=>{a.setFieldValue("options",C)},newValue:()=>({data:{text:"",description:"",val:"",flag:""}}),Editor:Ac,editorExtraProps:{showValueField:!!a.values.fn}})})]}),t.jsx(H,{changeField:a.handleChange,definitionImg:a.values.definitionImg,howMeasured:a.values.howMeasured,policyRef:a.values.policyRef,info:a.values.info}),t.jsx(V,{name:"notes",onChange:a.handleChange,value:a.values.notes})]})},Ec=c.flatFlags.filter(e=>!!e.value),wn=ta(Ec,e=>e.category),Lc=e=>{const{flag:n,existingOverrides:a}=e,[r,i]=T.useState(!1),o=!!a;return t.jsxs(b,{sx:{cursor:"pointer"},padding:1,bgcolor:n.bgColor,color:n.color,mt:1,children:[t.jsx(b,{onClick:()=>i(l=>!l),children:t.jsxs(I,{variant:"body2",children:[n.text,o&&"*"]})}),t.jsx(zn,{in:r,children:t.jsxs(b,{display:"flex",mt:1,children:[t.jsx(g,{value:(a==null?void 0:a.heading)??"",placeholder:"Heading",onChange:l=>e.onChange({...a,heading:l.target.value})}),t.jsx(b,{width:10}),t.jsx(g,{value:(a==null?void 0:a.description)??"",placeholder:"Description",onChange:l=>e.onChange({...a,description:l.target.value})})]})})]})},Nc=e=>{var r,i,o,l;const n=D({initialValues:{flagSet:((i=(r=e.node)==null?void 0:r.data)==null?void 0:i.flagSet)||Object.keys(wn)[0],overrides:((l=(o=e.node)==null?void 0:o.data)==null?void 0:l.overrides)||{}},onSubmit:s=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.Result,data:s})},validate:()=>{}}),a=wn[n.values.flagSet];return t.jsx("form",{onSubmit:n.handleSubmit,id:"modal",children:t.jsx(k,{children:t.jsxs(_,{title:"Result",Icon:O[c.ComponentType.Result],children:[t.jsxs(u,{children:[t.jsx(I,{variant:"h5",component:"h6",children:t.jsx("label",{htmlFor:"result-flagSet",children:"Flag set"})}),t.jsx("select",{id:"result-flagSet",name:"flagSet",value:n.values.flagSet,onChange:n.handleChange,required:!0,children:Object.keys(wn).map(s=>t.jsx("option",{value:s,children:s},s))})]}),t.jsxs(b,{mt:2,children:[t.jsx(I,{variant:"h5",component:"h6",children:"Flag Text Overrides (optional)"}),t.jsx(I,{variant:"body2",children:"The overrides you set here will change what is displayed to the user upon arriving at this result. If you provide no overrides, the flag title will be used."}),t.jsx(b,{mt:2,children:a.map(s=>t.jsx(Lc,{flag:s,existingOverrides:n.values.overrides&&n.values.overrides[s.value],onChange:d=>{n.setFieldValue("overrides",{...n.values.overrides,[s.value]:d})}},s.value))})]})]})})})},Vc=e=>({title:(e==null?void 0:e.title)||"Check your answers before sending your application",description:(e==null?void 0:e.description)||"",notes:(e==null?void 0:e.notes)||""});function zc(e){var a;const n=D({initialValues:Vc((a=e.node)==null?void 0:a.data),onSubmit:r=>{var i;(i=e.handleSubmit)==null||i.call(e,{type:c.ComponentType.Review,data:r})}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Review",Icon:O[c.ComponentType.Review],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",placeholder:n.values.title,value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{name:"description",placeholder:"Description",value:n.values.description,onChange:n.handleChange})})]})}),t.jsx(V,{name:"notes",onChange:n.handleChange,value:n.values.notes})]})}function Bc(e){var a;const n=D({initialValues:ci((a=e.node)==null?void 0:a.data),onSubmit:r=>{var i;(i=e.handleSubmit)==null||i.call(e,{type:c.ComponentType.Section,data:r})}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Section marker",Icon:O[c.ComponentType.Section],children:[t.jsx(u,{children:t.jsx(g,{required:!0,format:"large",name:"title",placeholder:"Title",value:n.values.title,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Short section description",name:"description",value:n.values.description,onChange:n.handleChange})})]})}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const Uc=e=>{var i;const n=D({initialValues:ui((i=e.node)==null?void 0:i.data),onSubmit:o=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.Send,data:o})},validateOnBlur:!1,validateOnChange:!0,validationSchema:hi({destinations:pi().required().test({name:"atLeastOneChecked",message:"Select at least one destination",test:o=>!!(o&&o.length>0)})})}),a=[{value:Ae.BOPS,label:"BOPS"},{value:Ae.Uniform,label:"Uniform"},{value:Ae.Email,label:"Email to planning office"}];a.push({value:Ae.S3,label:"Upload to AWS S3 bucket"});const r=o=>l=>{var v,f,x,C;let s;n.values.destinations.includes(o)?s=n.values.destinations.filter(m=>m!==o):s=[...n.values.destinations,o],n.setFieldValue("destinations",s.sort((m,h)=>{const y=a.map(w=>w.value);return y.indexOf(m)-y.indexOf(h)}));const d=(f=(v=window.location.pathname)==null?void 0:v.split("/"))==null?void 0:f[1],p=(C=(x=window.location.pathname)==null?void 0:x.split("/"))==null?void 0:C[2];o===Ae.BOPS&&s.includes(o)&&alert("BOPS only accepts Lawful Development Certificate, Prior Approval, and Planning Permission submissions. Please do not select if you're building another type of submission service!"),o===Ae.Uniform&&s.includes(o)&&p!=="apply-for-a-lawful-development-certificate"&&!["buckinghamshire","lambeth","southwark"].includes(d)&&alert("Uniform is only enabled for Bucks, Lambeth and Southwark to accept Lawful Development Certificate submissions. Please do not select if you're building another type of submission service!"),o===Ae.S3&&s.includes(o)&&!["barnet","lambeth"].includes(d)&&alert("AWS S3 uploads are currently being prototyped with Barnet and Lambeth only. Please do not select this option for other councils yet.")};return t.jsx("form",{onSubmit:n.handleSubmit,id:"modal",children:t.jsx(k,{children:t.jsxs(_,{title:"Send",Icon:O[c.ComponentType.Send],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",value:n.values.title,placeholder:"Editor title",onChange:n.handleChange})}),t.jsx(b,{mt:2,children:t.jsx(Ln,{error:Ur(n.errors,"destinations"),children:t.jsx(Ue,{container:!0,spacing:0,children:a.map(o=>t.jsx(Ue,{item:!0,xs:12,children:t.jsx(fi,{id:o.value,label:o.label,onChange:r(o.value),checked:n.values.destinations.includes(o.value)})},o.value))})})}),t.jsxs(b,{display:"flex",mt:2,children:[t.jsx(vi,{titleAccess:"Warning",color:"primary",fontSize:"large"}),t.jsx(I,{variant:"body2",ml:1,children:"API tokens may be required to submit successfully. Check in with PlanX developers before launching your service to make sure that submissions are configured for your environment."})]})]})})})},qc=e=>({fn:(e==null?void 0:e.fn)||"",val:(e==null?void 0:e.val)||"",...ge(e)});function Hc(e){var a;const n=D({initialValues:qc((a=e.node)==null?void 0:a.data),onSubmit:r=>{var i;(i=e.handleSubmit)==null||i.call(e,{type:c.ComponentType.SetValue,data:r})}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsxs(k,{children:[t.jsx(_,{title:"Passport field name",children:t.jsx(u,{children:t.jsx(g,{required:!0,format:"data",name:"fn",value:n.values.fn,placeholder:"key",onChange:n.handleChange})})}),t.jsx(_,{title:"Field value",children:t.jsx(u,{children:t.jsxs("div",{children:[t.jsx(g,{required:!0,format:"data",name:"val",value:n.values.val,placeholder:"value",onChange:n.handleChange}),n.values.fn&&n.values.val&&t.jsxs("p",{children:["any existing value for ",t.jsx("strong",{children:n.values.fn})," ","will be replaced by ",t.jsx("strong",{children:n.values.val})]})]})})})]}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})}const Wc=e=>{var n;return{tasks:((n=e==null?void 0:e.taskList)==null?void 0:n.tasks)||(e==null?void 0:e.tasks)||[],title:(e==null?void 0:e.title)||"",description:(e==null?void 0:e.description)||"",...ge(e)}},Gc=()=>({title:"",description:""}),Yc=e=>t.jsxs(b,{sx:{flex:1},children:[t.jsx(u,{children:t.jsx(g,{required:!0,name:"title",value:e.value.title,onChange:n=>{e.onChange({...e.value,title:n.target.value})},placeholder:"Title"})}),t.jsx(u,{children:t.jsx(R,{required:!0,name:"description",value:e.value.description,onChange:n=>{e.onChange({...e.value,description:n.target.value})},placeholder:"Description"})})]}),Jc=e=>{var a;const n=D({initialValues:Wc((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.TaskList,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Task List",Icon:O[c.ComponentType.TaskList],children:[t.jsxs(b,{mb:"1rem",children:[t.jsx(u,{children:t.jsx(g,{name:"title",value:n.values.title,onChange:n.handleChange,placeholder:"Main Title",format:"large"})}),t.jsx(u,{children:t.jsx(R,{name:"description",value:n.values.description,onChange:n.handleChange,placeholder:"Main Description"})})]}),t.jsx(Te,{values:n.values.tasks,onChange:r=>{n.setFieldValue("tasks",r)},Editor:Yc,newValue:Gc})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",onChange:n.handleChange,value:n.values.notes})]})};function Kc(e){return t.jsx(b,{sx:{maxWidth:"fit-content","& button":{width:"100% "}},children:e.options.map((n,a)=>t.jsx(ae,{selected:e.value===n.value,onClick:()=>{e.onChange(n.value)},children:n.label},a))})}const Xc=e=>{var a;const n=D({initialValues:mi((a=e.node)==null?void 0:a.data),onSubmit:r=>{e.handleSubmit&&e.handleSubmit({type:c.ComponentType.TextInput,data:r})},validate:()=>{}});return t.jsxs("form",{onSubmit:n.handleSubmit,id:"modal",children:[t.jsx(k,{children:t.jsxs(_,{title:"Text Input",Icon:O[c.ComponentType.TextInput],children:[t.jsx(u,{children:t.jsx(g,{format:"large",name:"title",value:n.values.title,placeholder:"Title",onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(R,{placeholder:"Description",name:"description",value:n.values.description,onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(g,{format:"data",name:"fn",value:n.values.fn,placeholder:"Data Field",onChange:n.handleChange})}),t.jsx(u,{children:t.jsx(Kc,{options:[{value:"short",label:"Short"},{value:"long",label:"Long (250 characters)"},{value:"extraLong",label:"Extra long (500 characters)"},{value:"email",label:"Email"},{value:"phone",label:"Phone"}],value:n.values.type,onChange:r=>{n.setFieldValue("type",r)}})})]})}),t.jsx(H,{changeField:n.handleChange,definitionImg:n.values.definitionImg,howMeasured:n.values.howMeasured,policyRef:n.values.policyRef,info:n.values.info}),t.jsx(V,{name:"notes",value:n.values.notes,onChange:n.handleChange})]})},Qc=()=>null,Wa={"address-input":Ts,calculate:$s,checklist:Gd,confirmation:Kd,"contact-input":Xd,content:Zd,"date-input":ec,"draw-boundary":nc,"external-portal":tc,"file-upload":ac,filter:dc,"find-property-merged":cc,flow:Qc,"internal-portal":pc,"file-upload-and-label":oc,"next-steps":xc,notice:jc,"number-input":Cc,pay:kc,"planning-constraints":Fc,"property-information":Dc,question:Mc,result:Nc,review:zc,section:Bc,send:Uc,"set-value":Hc,"task-list":Jc,"text-input":Xc};var it={},Zc=Q;Object.defineProperty(it,"__esModule",{value:!0});var Ga=it.default=void 0,eu=Zc(X()),nu=t,tu=(0,eu.default)((0,nu.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"}),"CloseOutlined");Ga=it.default=tu;const ot={[c.ComponentType.AddressInput]:"address-input",[c.ComponentType.Checklist]:"checklist",[c.ComponentType.Confirmation]:"confirmation",[c.ComponentType.ContactInput]:"contact-input",[c.ComponentType.Content]:"content",[c.ComponentType.Calculate]:"calculate",[c.ComponentType.DateInput]:"date-input",[c.ComponentType.DrawBoundary]:"draw-boundary",[c.ComponentType.ExternalPortal]:"external-portal",[c.ComponentType.FileUpload]:"file-upload",[c.ComponentType.Filter]:"filter",[c.ComponentType.FindProperty]:"find-property-merged",[c.ComponentType.Flow]:"flow",[c.ComponentType.InternalPortal]:"internal-portal",[c.ComponentType.FileUploadAndLabel]:"file-upload-and-label",[c.ComponentType.NextSteps]:"next-steps",[c.ComponentType.Notice]:"notice",[c.ComponentType.NumberInput]:"number-input",[c.ComponentType.Pay]:"pay",[c.ComponentType.PlanningConstraints]:"planning-constraints",[c.ComponentType.PropertyInformation]:"property-information",[c.ComponentType.Answer]:"question",[c.ComponentType.Result]:"result",[c.ComponentType.Review]:"review",[c.ComponentType.Section]:"section",[c.ComponentType.Send]:"send",[c.ComponentType.SetValue]:"set-value",[c.ComponentType.Question]:"question",[c.ComponentType.TaskList]:"task-list",[c.ComponentType.TextInput]:"text-input"},au=e=>{const n=Object.entries(ot).find(([a,r])=>r===e);return n&&Number(n[0])},ru=$(Kt)(({theme:e})=>({"& > * > *":{backgroundColor:e.palette.background.paper}})),iu=$(Ke)(({theme:e})=>({margin:"0 0 0 auto",padding:e.spacing(1),color:e.palette.grey[600]})),ou=$("select")(()=>({fontSize:"1em",padding:"0.25em"})),lu=e=>t.jsxs(ou,{value:au(e.value),onChange:n=>{e.onChange(n.target.value)},children:[t.jsxs("optgroup",{label:"Question",children:[t.jsx("option",{value:c.ComponentType.Question,children:"Question"}),t.jsx("option",{value:c.ComponentType.Checklist,children:"Checklist"}),t.jsx("option",{value:c.ComponentType.NextSteps,children:"Next steps"})]}),t.jsxs("optgroup",{label:"Inputs",children:[t.jsx("option",{value:c.ComponentType.TextInput,children:"Text Input"}),t.jsx("option",{value:c.ComponentType.FileUpload,children:"File Upload"}),t.jsx("option",{value:c.ComponentType.FileUploadAndLabel,children:"Upload and label"}),t.jsx("option",{value:c.ComponentType.NumberInput,children:"Number Input"}),t.jsx("option",{value:c.ComponentType.DateInput,children:"Date Input"}),t.jsx("option",{value:c.ComponentType.AddressInput,children:"Address Input"}),t.jsx("option",{value:c.ComponentType.ContactInput,children:"Contact Input"})]}),t.jsxs("optgroup",{label:"Information",children:[t.jsx("option",{value:c.ComponentType.TaskList,children:"Task List"}),t.jsx("option",{value:c.ComponentType.Notice,children:"Notice"}),t.jsx("option",{value:c.ComponentType.Result,children:"Result"}),t.jsx("option",{value:c.ComponentType.Content,children:"Content"}),t.jsx("option",{value:c.ComponentType.Review,children:"Review"}),t.jsx("option",{value:c.ComponentType.Confirmation,children:"Confirmation"})]}),t.jsxs("optgroup",{label:"Location",children:[t.jsx("option",{value:c.ComponentType.FindProperty,children:"Find property"}),t.jsx("option",{value:c.ComponentType.PropertyInformation,children:"Property information"}),t.jsx("option",{value:c.ComponentType.DrawBoundary,children:"Draw boundary"}),t.jsx("option",{value:c.ComponentType.PlanningConstraints,children:"Planning constraints"})]}),t.jsxs("optgroup",{label:"Navigation",children:[t.jsx("option",{value:c.ComponentType.Filter,children:"Filter"}),t.jsx("option",{value:c.ComponentType.InternalPortal,children:"Internal Portal"}),t.jsx("option",{value:c.ComponentType.ExternalPortal,children:"External Portal"}),t.jsx("option",{value:c.ComponentType.Section,children:"Section"}),t.jsx("option",{value:c.ComponentType.SetValue,children:"Set Value"})]}),t.jsxs("optgroup",{label:"Payment",children:[t.jsx("option",{value:c.ComponentType.Calculate,children:"Calculate"}),t.jsx("option",{value:c.ComponentType.Pay,children:"Pay"})]}),t.jsx("optgroup",{label:"Outputs",children:t.jsx("option",{value:c.ComponentType.Send,children:"Send"})})]}),Ya=({type:e,handleDelete:n,Component:a,id:r,before:i,parent:o,extraProps:l})=>{const{navigate:s}=na(),[d,p,v,f,x]=N(h=>[h.addNode,h.updateNode,h.flow[r],h.makeUnique,h.connect]),C=()=>s(Ee(!0)),m=window.location.pathname.split("/")[1];return t.jsxs(ru,{open:!0,fullWidth:!0,maxWidth:"md",disableScrollLock:!0,onClose:C,children:[t.jsxs(Xt,{sx:{py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[!n&&t.jsx(lu,{value:e,onChange:h=>{const y=new URL(window.location.href);y.searchParams.set("type",ot[Number(h)]),s([y.pathname,y.search].join(""))}}),t.jsx(iu,{"aria-label":"close",onClick:C,size:"large",children:t.jsx(Ga,{})})]}),t.jsx(Qt,{dividers:!0,children:t.jsx(Bt,{FallbackComponent:Bn,children:t.jsx(a,{node:v,...v==null?void 0:v.data,...l,id:r,handleSubmit:(h,y=void 0)=>{if(typeof h=="string")x(o,h,{before:i});else{const w=vt(Object.entries(h)),j=(y==null?void 0:y.map(E=>vt(Object.entries(E))))||void 0;n?p({id:r,...w},{children:j}):d(w,{children:j,parent:o,before:i})}s(Ee(!0))}})})}),t.jsx(Zt,{sx:{p:0},children:t.jsxs(Ue,{container:!0,justifyContent:"flex-end",children:[n&&t.jsx(Ue,{item:!0,xs:6,sm:4,md:3,children:t.jsx(fe,{fullWidth:!0,size:"medium",onClick:()=>{n(),s(Ee(!0))},disabled:!N.getState().canUserEditTeam(m),children:"delete"})}),n&&t.jsx(Ue,{item:!0,xs:6,sm:4,md:3,children:t.jsx(fe,{fullWidth:!0,size:"medium",onClick:()=>{f(r,o),s(Ee(!0))},disabled:!N.getState().canUserEditTeam(m),children:"make unique"})}),t.jsx(Ue,{item:!0,xs:6,sm:4,md:3,children:t.jsx(fe,{fullWidth:!0,size:"medium",type:"submit",variant:"contained",color:"primary",form:"modal",disabled:!N.getState().canUserEditTeam(m),children:n?`Update ${e}`:`Create ${e}`})})]})})]})},cn=async e=>{const{data:{flows:[{settings:n}]}}=await Cr.query({query:He`
      query GetFlow($slug: String!, $team_slug: String!) {
        flows(
          limit: 1
          where: { slug: { _eq: $slug }, team: { slug: { _eq: $team_slug } } }
        ) {
          id
          settings
        }
      }
    `,variables:{slug:e.params.flow,team_slug:e.params.team}});N.getState().setFlowSettings(n)},su=[{name:"Service",route:"service",Component:sa},{name:"Service Flags",route:"flags",Component:la},{name:"Data",route:"data-manager",Component:oa},{name:"Submissions",route:"submissions",Component:ua}],du=Me(Ht(e=>({mountpath:e.mountpath})),Nn({"/":Ut("./service"),"/:tab":ln(async e=>{if(!N.getState().canUserEditTeam(e.params.team))throw new qt(`User does not have access to ${e.originalUrl}`);return Ce({getData:cn,title:we([e.params.team,e.params.flow,"Flow Settings"].join("/")),view:t.jsx(kr,{currentTab:e.params.tab,tabs:su})})})})),cu=Object.freeze(Object.defineProperty({__proto__:null,default:du,getFlowSettings:cn},Symbol.toStringTag,{value:"Module"})),Mt=["EDITOR_NAVIGATION"],pe=(()=>{let e=new Set;try{const n=localStorage.getItem("FEATURE_FLAGS");n&&(e=new Set(JSON.parse(n)))}catch{}return e})(),uu=(e,n=!0)=>{const a=Mt.includes(e);if(pe.has(e))pe.delete(e);else if(a)pe.add(e);else throw new Error(`${e} is not a supported feature flag, try again. Available flags are: ${Mt}`);localStorage.setItem("FEATURE_FLAGS",JSON.stringify(Array.from(pe))),n&&window.location.reload()},Ja=e=>pe.has(e);window.featureFlags={toggle:uu,active:pe,has:Ja};console.debug(pe.size>0?`🎏 ${pe.size} feature flags enabled: ${[...pe].sort().join(", ")}`:"🎏 no active feature flags");var lt={},hu=Q;Object.defineProperty(lt,"__esModule",{value:!0});var Ka=lt.default=void 0,pu=hu(X()),fu=t,vu=(0,pu.default)((0,fu.jsx)("path",{fillRule:"evenodd",d:"M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM10 17H5v-2h5v2zm0-4H5v-2h5v2zm0-4H5V7h5v2zm4.82 6L12 12.16l1.41-1.41 1.41 1.42L17.99 9l1.42 1.42L14.82 15z"}),"FactCheck");Ka=lt.default=vu;var st={},mu=Q;Object.defineProperty(st,"__esModule",{value:!0});var Xa=st.default=void 0,gu=mu(X()),xu=t,yu=(0,gu.default)((0,xu.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 14v-2.47l6.88-6.88c.2-.2.51-.2.71 0l1.77 1.77c.2.2.2.51 0 .71L8.47 14H6zm12 0h-7.5l2-2H18v2z"}),"RateReview");Xa=st.default=yu;var dt={},bu=Q;Object.defineProperty(dt,"__esModule",{value:!0});var Qa=dt.default=void 0,ju=bu(X()),Cu=t,wu=(0,ju.default)((0,Cu.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"}),"Tune");Qa=dt.default=wu;function Su(e){return t.jsx(wr,{...e,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20.01",children:t.jsx("polygon",{points:"15.54 13.6 15.41 13.6 15.41 10.67 15.41 10.4 15.41 9.34 10.8 9.34 10.8 6.41 15.3 6.41 15.3 1.11 10.8 1.11 9.47 1.11 4.7 1.11 4.7 6.41 9.47 6.41 9.47 9.34 4.59 9.34 4.59 10.4 4.59 10.67 4.59 13.6 4.46 13.6 2.07 13.6 2.07 18.91 4.59 18.91 5.92 18.91 8.44 18.91 8.44 13.6 6.05 13.6 5.92 13.6 5.92 10.67 14.08 10.67 14.08 13.6 13.95 13.6 11.56 13.6 11.56 18.91 14.08 18.91 15.41 18.91 17.93 18.91 17.93 13.6 15.54 13.6","stroke-width":"0"})})}const An="46px",Tu=$(b)(({theme:e})=>({width:An,flexShrink:0,background:e.palette.background.paper,borderRight:`1px solid ${e.palette.border.main}`})),Iu=$("ul")(({theme:e})=>({listStyle:"none",margin:0,padding:e.spacing(4,0,0,0)})),_u=$("li")(({theme:e})=>({margin:e.spacing(.75,0),padding:0})),$u=$(({className:e,...n})=>t.jsx(se,{...n,arrow:!0,placement:"right",classes:{popper:e}}))(()=>({[`& .${Sn.arrow}`]:{color:"#2c2c2c"},[`& .${Sn.tooltip}`]:{backgroundColor:"#2c2c2c",left:"-5px",fontSize:"0.8em",borderRadius:0,fontWeight:un}})),Pu=$(Ke,{shouldForwardProp:e=>e!=="isActive"})(({theme:e,isActive:n})=>({color:e.palette.primary.main,width:An,height:An,border:"1px solid transparent",borderRightColor:e.palette.border.main,"&:hover":{background:"white",borderTopColor:e.palette.border.light,borderBottomColor:e.palette.border.light},...n&&{background:e.palette.common.white,color:e.palette.text.primary,border:`1px solid ${e.palette.border.main}`,borderRightColor:"transparent"}}));function Ru(){const{navigate:e}=na(),{url:n}=qr(),a=Ee(),r=l=>n.pathname.endsWith(l),i=l=>!r(l)&&e(a+l),o=[{title:"Editor",Icon:Su,route:"/"},{title:"Service settings",Icon:Qa,route:"/service"},{title:"Submissions log",Icon:Ka,route:"/submissions-log"},{title:"Feedback",Icon:Xa,route:"/feedback"}];return t.jsx(Tu,{children:t.jsx(Iu,{children:o.map(({title:l,Icon:s,route:d})=>t.jsx(_u,{onClick:()=>i(d),children:t.jsx($u,{title:l,children:t.jsx(Pu,{isActive:r(d),disableRipple:!0,children:t.jsx(s,{})})})},l))})})}const ku=$(b)(()=>({display:"flex",alignItems:"stretch",overflow:"hidden",flexGrow:1})),Fu=({children:e})=>t.jsxs(ku,{children:[Ja("EDITOR_NAVIGATION")&&t.jsx(Ru,{}),t.jsx(Bt,{FallbackComponent:Bn,children:e})]}),Ou=async(e,n)=>{var o;const{data:{flows:a}}=await Wt.query({query:He`
      query GetFlow($slug: String!, $team_slug: String!) {
        flows(
          limit: 1
          where: { slug: { _eq: $slug }, team: { slug: { _eq: $team_slug } } }
        ) {
          id
          flowSettings: settings
          flowAnalyticsLink: analytics_link
          publishedFlowsAggregate: published_flows_aggregate {
            aggregate {
              count
            }
          }
        }
      }
    `,variables:{slug:e,team_slug:n}}),r=a[0];if(!a)throw new qt(`Flow ${e} not found for ${n}`);return{flowSettings:r.flowSettings,flowAnalyticsLink:r.flowAnalyticsLink,isFlowPublished:((o=r.publishedFlowsAggregate)==null?void 0:o.aggregate.count)>0}},Du=async e=>{const[n]=e.params.flow.split(","),{flowSettings:a,flowAnalyticsLink:r,isFlowPublished:i}=await Ou(n,e.params.team);return N.setState({flowSettings:a,flowAnalyticsLink:r,isFlowPublished:i}),t.jsx(Fu,{children:t.jsx(Vn,{})})},Au=_i({insensitive:!0}),Za=(e,n)=>Au(e.text.replace(/\W|\s/g,""),n.text.replace(/\W|\s/g,"")),er=async()=>{const{data:e}=await Wt.query({query:He`
      query GetFlows {
        flows(order_by: { slug: asc }) {
          id
          slug
          team {
            slug
          }
        }
      }
    `});return e.flows.filter(n=>n.team&&!window.location.pathname.includes(`${n.team.slug}/${n.slug}`)).map(({id:n,team:a,slug:r})=>({id:n,text:[a.slug,r].join("/")})).sort(Za)},nn=Ce(async e=>{const{type:n="question",before:a=void 0,parent:r=void 0}=e.params,i={};return n==="external-portal"?i.flows=await er():n==="internal-portal"&&(i.flows=Object.entries(N.getState().flow).filter(([o,l])=>{var s;return l.type===c.ComponentType.InternalPortal&&!window.location.pathname.includes(o)&&((s=l.data)==null?void 0:s.text)}).map(([o,{data:l}])=>({id:o,text:l.text})).sort(Za)),{title:we(`New ${n}`),view:t.jsx(Ya,{type:n,Component:Wa[n],extraProps:i,before:a,parent:r})}}),Mu=e=>ln(n=>{const{team:a,flow:r,id:i}=n.params;return N.getState().getNode(i)?e:Ut(`/${a}/${r}`)}),tn=Mu(Ce(async e=>{var s;const{id:n,before:a=void 0,parent:r=void 0}=e.params,i=N.getState().getNode(n),o={};i.type===c.ComponentType.ExternalPortal&&(o.flows=await er());const l=ot[i.type];if(l==="checklist"||l==="question"){const d=N.getState().childNodesOf(n);(s=i.data)!=null&&s.categories?o.groupedOptions=Sr((p,v)=>[p+v.count,{title:v.title,children:d.slice(p,p+v.count)}],0,i.data.categories)[1]:o.options=d}return{title:we(`Edit ${l}`),view:t.jsx(Ya,{type:l,Component:Wa[l],extraProps:o,node:i,id:n,handleDelete:()=>{N.getState().removeNode(n,r)},before:a,parent:r})}})),Eu=Nn({"/new/:before":nn,"/new":nn,"/:parent/nodes/new/:before":nn,"/:parent/nodes/new":nn,"/:id/edit":tn,"/:id/edit/:before":tn,"/:parent/nodes/:id/edit/:before":tn,"/:parent/nodes/:id/edit":tn}),an=()=>t.jsx(b,{sx:{width:"100%",px:4,py:5,overflowY:"auto"},children:t.jsx(Vn,{})}),Xu=Me(Ht(e=>({flow:e.params.flow.split(",")[0]})),ze(Du),Nn({"/":Ce(async e=>({title:we([e.params.team,e.params.flow].join("/")),view:()=>{const[n,...a]=e.params.flow.split(",");return t.jsx(kt,{flow:n,breadcrumbs:a},n)}})),"/feedback":ln(()=>pt(()=>import("./feedback-NqJ1fYKx.js"),__vite__mapDeps([0,1,2]))),"/nodes":Me(ze(e=>{const[n,...a]=e.params.flow.split(",");return t.jsxs(t.Fragment,{children:[t.jsx(kt,{flow:n,breadcrumbs:a},n),t.jsx(Vn,{})]})}),Eu),"/settings":ln(()=>pt(()=>Promise.resolve().then(()=>cu),void 0)),"/service":Me(ze(an),Ce(async e=>({getData:cn,title:we([e.params.team,e.params.flow,"service"].join("/")),view:sa}))),"/service-flags":Me(ze(an),Ce(async e=>({getData:cn,title:we([e.params.team,e.params.flow,"service-flags"].join("/")),view:la}))),"/data":Me(ze(an),Ce(async e=>({title:we([e.params.team,e.params.flow,"data"].join("/")),view:oa}))),"/submissions-log":Me(ze(an),Ce(async e=>({title:we([e.params.team,e.params.flow,"submissions-log"].join("/")),view:ua})))}));export{Xu as default};
