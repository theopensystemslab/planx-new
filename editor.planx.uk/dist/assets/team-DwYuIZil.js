const __vite__fileDeps=["assets/teamSettings-BjmE7GQA.js","assets/index-CFPw1vJP.js","assets/index-CpQhEK74.css","assets/EditorRow-Cyc30Qxl.js","assets/Card-XAp8rL3L.js","assets/index-DE9PmoNh.js","assets/InputRowLabel-DT0xESl6.js","assets/Header-p4OIyhRV.js","assets/flow-l9siX4_m.js","assets/Questions-D-dg2tg0.js","assets/Chip-BB62kn49.js","assets/TableRow-twy3mylU.js","assets/index-CO01K9Q0.js","assets/Divider-B5Mpa2_2.js","assets/authenticated-Ct7udYJY.js","assets/flow-B_IrcLq-.css","assets/teamMembers-BtaWCFnB.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{v as H,w as Y,j as s,y as V,z as W,s as h,T as $,ba as J,r as S,A as G,_ as K,b as R,C as Q,E as Z,I as ee,bb as te,bc as ae,b6 as ne,B as D,L as oe,ai as re,ay as se,u as f,o as w,N as A,Q as L,n as I,a7 as ie,W as le,V as ue,J as ce,K as de,M as N,S as fe,U as T,X as b,Y as ge,aa as me}from"./index-CFPw1vJP.js";import{r as m,g as u,l as k,m as he,n as pe,k as ve,d as Se,e as xe,D as we,o as De,p as _e,q as Me}from"./Header-p4OIyhRV.js";function _(e,t){m(2,arguments);var a=u(e),n=u(t),r=a.getTime()-n.getTime();return r<0?-1:r>0?1:r}function Te(e,t){m(2,arguments);var a=u(e),n=u(t),r=a.getFullYear()-n.getFullYear(),i=a.getMonth()-n.getMonth();return r*12+i}function be(e,t){return m(2,arguments),u(e).getTime()-u(t).getTime()}var E={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},je="trunc";function ye(e){return e?E[e]:E[je]}function Ce(e){m(1,arguments);var t=u(e);return t.setHours(23,59,59,999),t}function Ie(e){m(1,arguments);var t=u(e),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}function Ne(e){m(1,arguments);var t=u(e);return Ce(t).getTime()===Ie(t).getTime()}function ke(e,t){m(2,arguments);var a=u(e),n=u(t),r=_(a,n),i=Math.abs(Te(a,n)),o;if(i<1)o=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-r*i);var g=_(a,n)===-r;Ne(u(e))&&i===1&&_(e,n)===1&&(g=!1),o=r*(i-Number(g))}return o===0?0:o}function Ee(e,t,a){m(2,arguments);var n=be(e,t)/1e3;return ye(void 0)(n)}function q(e,t){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}function Oe(e){return q({},e)}var O=1440,Fe=2520,j=43200,$e=86400;function Re(e,t,a){var n,r;m(2,arguments);var i=pe(),o=(n=(r=a==null?void 0:a.locale)!==null&&r!==void 0?r:i.locale)!==null&&n!==void 0?n:he;if(!o.formatDistance)throw new RangeError("locale must contain formatDistance property");var g=_(e,t);if(isNaN(g))throw new RangeError("Invalid time value");var l=q(Oe(a),{addSuffix:!!(a!=null&&a.addSuffix),comparison:g}),c,x;g>0?(c=u(t),x=u(e)):(c=u(e),x=u(t));var p=Ee(x,c),X=(k(x)-k(c))/1e3,d=Math.round((p-X)/60),v;if(d<2)return a!=null&&a.includeSeconds?p<5?o.formatDistance("lessThanXSeconds",5,l):p<10?o.formatDistance("lessThanXSeconds",10,l):p<20?o.formatDistance("lessThanXSeconds",20,l):p<40?o.formatDistance("halfAMinute",0,l):p<60?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",1,l):d===0?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",d,l);if(d<45)return o.formatDistance("xMinutes",d,l);if(d<90)return o.formatDistance("aboutXHours",1,l);if(d<O){var B=Math.round(d/60);return o.formatDistance("aboutXHours",B,l)}else{if(d<Fe)return o.formatDistance("xDays",1,l);if(d<j){var P=Math.round(d/O);return o.formatDistance("xDays",P,l)}else if(d<$e)return v=Math.round(d/j),o.formatDistance("aboutXMonths",v,l)}if(v=ke(x,c),v<12){var z=Math.round(d/j);return o.formatDistance("xMonths",z,l)}else{var C=v%12,M=Math.floor(v/12);return C<3?o.formatDistance("aboutXYears",M,l):C<9?o.formatDistance("overXYears",M,l):o.formatDistance("almostXYears",M+1,l)}}function Ae(e,t){return m(1,arguments),Re(e,Date.now(),t)}var y={},Le=Y;Object.defineProperty(y,"__esModule",{value:!0});var U=y.default=void 0,qe=Le(H()),Ue=s,Xe=(0,qe.default)((0,Ue.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");U=y.default=Xe;function Be(e){return V("MuiDialogContentText",e)}W("MuiDialogContentText",["root"]);const Pe=["children","className"],ze=e=>{const{classes:t}=e,n=Z({root:["root"]},Be,t);return R({},t,n)},He=h($,{shouldForwardProp:e=>J(e)||e==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),Ye=S.forwardRef(function(t,a){const n=G({props:t,name:"MuiDialogContentText"}),{className:r}=n,i=K(n,Pe),o=ze(i);return s.jsx(He,R({component:"p",variant:"body1",color:"text.secondary",ref:a,ownerState:i,className:Q(o.root,r)},n,{classes:o}))});function Ve({items:e,...t}){const[a,n]=S.useState(null);return s.jsxs("div",{...t,children:[s.jsx(ee,{color:"inherit",onClick:r=>{n(r.currentTarget)},"aria-label":"Options",size:"large",children:s.jsx(te,{})}),s.jsx(ae,{id:"long-menu",anchorEl:a,keepMounted:!0,open:!!a,onClose:()=>{n(null)},children:e.map((r,i)=>s.jsx(ne,{style:r.error?{color:"red"}:{},disabled:r.disabled,onClick:()=>{r.onClick(),n(null)},children:r.label},i))})]})}const We=h(D)(({theme:e})=>({backgroundColor:e.palette.background.dark,color:"#fff",width:"100%",flex:1,justifyContent:"flex-start",alignItems:"center"})),Je=h(D)(({theme:e})=>({backgroundColor:e.palette.background.dark,color:"#fff",width:"100%",maxWidth:600,margin:"auto",padding:e.spacing(8,0,4,0)})),Ge=h("ul")(({theme:e})=>({padding:e.spacing(0,0,3),borderBottom:"1px solid #fff",margin:0})),Ke=h("li")(({theme:e})=>({listStyle:"none",position:"relative",padding:e.spacing(2.5,2)})),Qe=h(oe)(({theme:e})=>({display:"block",fontSize:e.typography.h4.fontSize,textDecoration:"none",color:"currentColor",fontWeight:re,marginBottom:e.spacing(1.5),marginTop:0})),Ze=h(Ve)(({theme:e})=>({position:"absolute",top:e.spacing(2),right:e.spacing(1)})),et=h(D)(()=>({color:"#aaa","& a":{color:"#fff"}})),tt=(e,t=[])=>{var n;let a=`Edited ${Ae(new Date(e))} ago`;if((n=t[0])!=null&&n.actor){const{first_name:r,last_name:i}=t[0].actor;a+=` by ${r} ${i}`}return a},at=({title:e,content:t,submitLabel:a,open:n,onClose:r,onConfirm:i})=>s.jsxs(we,{open:n,onClose:()=>{r()},children:[s.jsx(De,{children:e}),s.jsx(_e,{children:s.jsx(Ye,{children:t})}),s.jsxs(Me,{children:[s.jsx(I,{onClick:r,color:"primary",children:"Cancel"}),s.jsx(I,{onClick:i,color:"primary",children:a})]})]}),nt=h(se)(({theme:e})=>({width:"100%",padding:e.spacing(4),fontSize:20,backgroundColor:"rgba(255,255,255,0.25)",display:"block",textAlign:"left",marginTop:e.spacing(2)}));function ot({children:e,onClick:t}){return s.jsxs(nt,{onClick:t,children:[s.jsx(U,{sx:{mr:3,verticalAlign:"middle"}})," ",e]})}const rt=({flow:e,teamId:t,teamSlug:a,refreshFlows:n})=>{const[r,i]=S.useState(!1),o=()=>{f.getState().deleteFlow(t,e.slug).then(()=>{i(!1),n()})},g=()=>{f.getState().copyFlow(e.id).then(()=>{n()})},l=c=>{f.getState().moveFlow(e.id,c).then(()=>{n()})};return s.jsxs(s.Fragment,{children:[r&&s.jsx(at,{title:"Confirm Delete",open:r,content:"Deleting a service cannot be reversed.",onClose:()=>{i(!1)},onConfirm:o,submitLabel:"Delete Service"}),s.jsxs(Ke,{children:[s.jsxs(D,{pr:4,children:[s.jsx(Qe,{href:`./${e.slug}`,prefetch:!1,children:e.slug}),s.jsx(et,{children:tt(e.updated_at,e.operations)})]}),f.getState().canUserEditTeam(a)&&s.jsx(Ze,{items:[{onClick:async()=>{const c=prompt("New name",e.slug);c&&w(c)!==e.slug&&(await A.mutate({mutation:L`
                        mutation UpdateFlowSlug(
                          $teamId: Int
                          $slug: String
                          $newSlug: String
                        ) {
                          update_flows(
                            where: {
                              team: { id: { _eq: $teamId } }
                              slug: { _eq: $slug }
                            }
                            _set: { slug: $newSlug }
                          ) {
                            affected_rows
                          }
                        }
                      `,variables:{teamId:t,slug:e.slug,newSlug:w(c)}}),n())},label:"Rename"},{label:"Copy",onClick:()=>{g()}},{label:"Move",onClick:()=>{const c=prompt("New team");c&&(w(c)===a?alert(`This flow already belongs to ${a}, skipping move`):l(w(c)))}},{label:"Delete",onClick:()=>{i(!0)},error:!0}]})]})]})},st=()=>{const{id:e,slug:t}=f(o=>o.getTeam()),[a,n]=S.useState(null),r=ve(),i=S.useCallback(()=>{f.getState().getFlows(e).then(o=>{n(o.flows)})},[e,n]);return S.useEffect(()=>{i()},[i]),s.jsx(We,{children:s.jsxs(Je,{children:[s.jsxs(D,{pl:2,pb:2,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx($,{variant:"h2",component:"h1",children:"My services"}),f.getState().canUserEditTeam(t)?s.jsx(Se,{}):s.jsx(xe,{})]}),f.getState().canUserEditTeam(t)&&s.jsx(ot,{onClick:()=>{const o=prompt("Service name");if(o){const g=w(o);f.getState().createFlow(e,g).then(l=>{r.navigate(`/${t}/${l}`)})}},children:"Add a new service"}),a&&s.jsx(Ge,{children:a.map(o=>s.jsx(rt,{flow:o,teamId:e,teamSlug:t,refreshFlows:()=>{i()}},o.slug))})]})})},it=async e=>{const{initTeamStore:t,teamSlug:a}=f.getState(),n=e.params.team||await ie(window.location.hostname);if(a!==n)try{await t(n)}catch(r){throw new le(`Team not found: ${r}`)}return s.jsx(ue,{})};let F={flowSlug:void 0,teamSlug:void 0};const lt=ce(me(e=>({team:e.params.team})),ge(async e=>await it(e)),de({"/":N(()=>({title:fe(f.getState().teamName),view:s.jsx(st,{})})),"/settings":T(()=>b(()=>import("./teamSettings-BjmE7GQA.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),"/:flow":T(async e=>{const[t]=e.params.flow.split(","),a={flowSlug:t,teamSlug:e.params.team};if(JSON.stringify(F)!==JSON.stringify(a)){F=a;const{data:n}=await A.query({query:L`
            query GetFlow($flowSlug: String!, $teamSlug: String!) {
              flows(
                limit: 1
                where: {
                  slug: { _eq: $flowSlug }
                  team: { slug: { _eq: $teamSlug } }
                }
              ) {
                id
              }
            }
          `,variables:a}),r=n.flows[0];if(!r)return N({title:"Flow Not Found",view:s.jsx("p",{children:"Flow Not Found"})});f.getState().setFlowSlug(t),await f.getState().connectTo(r.id)}return b(()=>import("./flow-l9siX4_m.js"),__vite__mapDeps([8,1,2,3,4,5,6,7,9,10,11,12,13,14,15]))}),"/members":T(()=>b(()=>import("./teamMembers-BtaWCFnB.js"),__vite__mapDeps([16,1,2,3,4,7,11,10])))})),dt=Object.freeze(Object.defineProperty({__proto__:null,default:lt},Symbol.toStringTag,{value:"Module"}));export{Ve as S,Ae as f,dt as t};
